% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ds.psiAlign.R
\name{ds.psiAlign}
\alias{ds.psiAlign}
\title{ECDH-PSI Record Alignment}
\usage{
ds.psiAlign(
  data_name,
  id_col,
  newobj = "D_aligned",
  ref_server = NULL,
  datasources = NULL
)
}
\arguments{
\item{data_name}{Character string. Name of the data frame on each server.}

\item{id_col}{Character string. Name of the identifier column.}

\item{newobj}{Character string. Name for the aligned data frame on servers.
Default is \code{"D_aligned"}.}

\item{ref_server}{Character string or NULL. Name of the reference server.
If NULL (default), the first connection is used.}

\item{datasources}{DataSHIELD connection object or list of connections.
If NULL, uses all available connections.}
}
\value{
Invisibly returns a list with alignment statistics for each server:
\itemize{
\item \code{n_matched}: Number of records matched
\item \code{n_total}: Number of records on that server
}
}
\description{
Privacy-preserving record alignment using Elliptic Curve
Diffie-Hellman Private Set Intersection (ECDH-PSI). Aligns data frames
across vertically partitioned DataSHIELD servers so that rows correspond
to the same individuals, without exposing identifiers.
}
\details{
This function replaces \code{\link{ds.hashId}} + \code{\link{ds.alignRecords}}
with a single call that provides stronger privacy guarantees.

\subsection{Protocol overview}{
ECDH-PSI exploits the commutativity of elliptic curve scalar multiplication:
\eqn{\alpha \cdot (\beta \cdot H(id)) = \beta \cdot (\alpha \cdot H(id))}.

\enumerate{
\item The reference server hashes IDs to P-256 curve points and multiplies
by a random scalar \eqn{\alpha}. Returns masked points to client.
\item For each target server:
\itemize{
\item The target generates scalar \eqn{\beta}, double-masks ref points
with \eqn{\beta} (stores locally), and masks own IDs with \eqn{\beta}.
\item The reference double-masks target points with \eqn{\alpha}.
\item The target matches double-masked sets to find the intersection,
then reorders its data to match the reference order.
}
\item A multi-server intersection ensures only records present on ALL
servers are retained.
}
}

\subsection{Security (DDH assumption on P-256)}{
\itemize{
\item The client sees only opaque elliptic curve points â€” not reversible
to identifiers, not vulnerable to dictionary attacks.
\item Each server's scalar never leaves the server.
\item The DDH assumption prevents the client from linking single-masked
points across servers.
}
}
}
\examples{
\dontrun{
# Align records across all servers using PSI
ds.psiAlign("D", "patient_id", "D_aligned", datasources = connections)

# Now "D_aligned" on all servers has matching, ordered observations
}

}
\seealso{
\code{\link{ds.vertCor}}, \code{\link{ds.vertGLM}} for analysis
functions that operate on aligned data.
}
