<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>dsVertClient • dsVertClient</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="dsVertClient">
<meta name="description" content="Privacy-Preserving Analysis of Vertically Partitioned Data">
<meta property="og:description" content="Privacy-Preserving Analysis of Vertically Partitioned Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">dsVertClient</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="articles/pima-demo.html">Validation Study: Centralized vs. Federated Vertical Analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/isglobal-brge/dsVertClient" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="dsvertclient-datashield-client-functions-for-vertically-partitioned-data">dsVertClient: DataSHIELD Client Functions for Vertically Partitioned Data<a class="anchor" aria-label="anchor" href="#dsvertclient-datashield-client-functions-for-vertically-partitioned-data"></a>
</h1></div>
<p><a href="https://opensource.org/licenses/MIT" class="external-link"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p><strong>dsVertClient</strong> is a client-side DataSHIELD package that enables privacy-preserving statistical analysis on <strong>vertically partitioned federated data</strong>. In vertical partitioning, different data sources hold different variables (columns) for the same set of observations (rows).</p>
<p>This package provides user-friendly functions for:</p>
<ul>
<li>
<strong>ECDH-PSI Record Alignment</strong>: Privacy-preserving record matching using P-256 elliptic curves (no dictionary attacks possible)</li>
<li>
<strong>Correlation Analysis</strong>: Compute correlation matrices using <strong>Multiparty Homomorphic Encryption (MHE)</strong> with share-wrapped threshold decryption</li>
<li>
<strong>Principal Component Analysis</strong>: Perform PCA from the MHE-based correlation matrix</li>
<li>
<strong>Generalized Linear Models</strong>: Fit GLMs using IRLS with encrypted-label BCD and GLM secure routing (3 families)</li>
</ul>
</div>
<div class="section level2">
<h2 id="security-guarantees">Security Guarantees<a class="anchor" aria-label="anchor" href="#security-guarantees"></a>
</h2>
<div class="section level3">
<h3 id="record-alignment-ecdh-psi">Record Alignment (ECDH-PSI)<a class="anchor" aria-label="anchor" href="#record-alignment-ecdh-psi"></a>
</h3>
<table class="table">
<colgroup>
<col width="37%">
<col width="62%">
</colgroup>
<thead><tr>
<th>Property</th>
<th>What it prevents</th>
</tr></thead>
<tbody>
<tr>
<td><strong>Dictionary attack resistance</strong></td>
<td>Unlike SHA-256 hashing, the client CANNOT reverse-engineer patient IDs from the masked curve points (requires server’s secret scalar)</td>
</tr>
<tr>
<td><strong>Scalar confidentiality</strong></td>
<td>Each server’s P-256 random scalar stays on-server</td>
</tr>
<tr>
<td><strong>Unlinkability (DDH)</strong></td>
<td>The client CANNOT link single-masked points across servers</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="statistical-analysis-mhe-ckks">Statistical Analysis (MHE-CKKS)<a class="anchor" aria-label="anchor" href="#statistical-analysis-mhe-ckks"></a>
</h3>
<table class="table">
<colgroup>
<col width="37%">
<col width="62%">
</colgroup>
<thead><tr>
<th>Property</th>
<th>What it prevents</th>
</tr></thead>
<tbody>
<tr>
<td><strong>Client privacy</strong></td>
<td>The researcher CANNOT decrypt any individual data. Only aggregate statistics (correlations, coefficients) are revealed after all servers cooperate.</td>
</tr>
<tr>
<td><strong>Server privacy</strong></td>
<td>Each server’s raw data never leaves the server. Other servers only see encrypted ciphertexts (opaque).</td>
</tr>
<tr>
<td><strong>Collusion resistance</strong></td>
<td>Even K-1 colluding servers cannot decrypt without the K-th server’s key share. Full decryption requires ALL K servers.</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="transport--routing-security">Transport &amp; Routing Security<a class="anchor" aria-label="anchor" href="#transport--routing-security"></a>
</h3>
<table class="table">
<colgroup>
<col width="37%">
<col width="62%">
</colgroup>
<thead><tr>
<th>Property</th>
<th>What it prevents</th>
</tr></thead>
<tbody>
<tr>
<td><strong>Share-wrapping</strong></td>
<td>Client CANNOT see or manipulate partial decryption shares. Each share is transport-encrypted under the fusion server’s X25519 key before relay.</td>
</tr>
<tr>
<td><strong>GLM secure routing</strong></td>
<td>Client CANNOT see individual-level vectors (eta, mu, w, v). Only sees p_k-length coefficient vectors and opaque encrypted blobs.</td>
</tr>
<tr>
<td><strong>Protocol Firewall</strong></td>
<td>Only ciphertexts produced by authorized operations can be decrypted. Prevents decryption oracle attacks.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Install from GitHub (install dsVert first on servers)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"isglobal-brge/dsVertClient"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="quick-start">Quick Start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/isglobal-brge/dsVertClient" class="external-link">dsVertClient</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSI/" class="external-link">DSI</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Connect to Opal/DataSHIELD servers</span></span>
<span><span class="va">conns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span><span class="va">logindata</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 1. Align records across servers using ECDH-PSI</span></span>
<span><span class="fu"><a href="reference/ds.psiAlign.html">ds.psiAlign</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"patient_id"</span>, <span class="st">"D_aligned"</span>, datasources <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Define which variables are on which server</span></span>
<span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  hospital_A <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span><span class="op">)</span>,</span>
<span>  hospital_B <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glucose"</span>, <span class="st">"systolic_bp"</span><span class="op">)</span>,</span>
<span>  hospital_C <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cholesterol"</span>, <span class="st">"hdl"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. Compute correlation matrix (MHE with share-wrapped threshold decryption)</span></span>
<span><span class="va">cor_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ds.vertCor.html">ds.vertCor</a></span><span class="op">(</span><span class="st">"D_aligned"</span>, <span class="va">variables</span>, datasources <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cor_result</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 4. Perform PCA</span></span>
<span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ds.vertPCA.html">ds.vertPCA</a></span><span class="op">(</span><span class="st">"D_aligned"</span>, <span class="va">variables</span>, n_components <span class="op">=</span> <span class="fl">3</span>, datasources <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pca</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 5. Fit a GLM</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/ds.vertGLM.html">ds.vertGLM</a></span><span class="op">(</span><span class="st">"D_aligned"</span>, <span class="st">"outcome"</span>, <span class="va">variables</span>,</span>
<span>                    y_server <span class="op">=</span> <span class="st">"hospital_B"</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                    datasources <span class="op">=</span> <span class="va">conns</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Disconnect</span></span>
<span><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.logout.html" class="external-link">datashield.logout</a></span><span class="op">(</span><span class="va">conns</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="client-side-functions">Client-Side Functions<a class="anchor" aria-label="anchor" href="#client-side-functions"></a>
</h2>
<table class="table">
<colgroup>
<col width="43%">
<col width="56%">
</colgroup>
<thead><tr>
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr>
<td><code>ds.psiAlign</code></td>
<td>Align records across servers using ECDH-PSI</td>
</tr>
<tr>
<td><code>ds.vertCor</code></td>
<td>Compute cross-server correlation matrix via MHE share-wrapped threshold decryption</td>
</tr>
<tr>
<td><code>ds.vertPCA</code></td>
<td>Perform PCA from the MHE-based correlation matrix</td>
</tr>
<tr>
<td><code>ds.vertGLM</code></td>
<td>Fit Generalized Linear Models via encrypted-label BCD with GLM secure routing</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="workflow-align---analyze">Workflow: Align -&gt; Analyze<a class="anchor" aria-label="anchor" href="#workflow-align---analyze"></a>
</h2>
<pre><code> ┌──────────────────┐   ┌───────────────────────────┐
 │  ds.psiAlign     │──▶│        Analyze            │
 │  (ECDH-PSI)      │   │  ds.vertCor (MHE)         │
 │                   │   │  ds.vertPCA               │
 │                   │   │  ds.vertGLM (BCD + MHE)   │
 └──────────────────┘   └───────────────────────────┘</code></pre>
</div>
<div class="section level2">
<h2 id="mhe-correlation-how-it-works">MHE Correlation: How It Works<a class="anchor" aria-label="anchor" href="#mhe-correlation-how-it-works"></a>
</h2>
<p>The 6-phase threshold MHE protocol:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Key Generation</strong>: Each server generates its own secret key share and public key share. Party 0 creates the Common Reference Polynomial (CRP).</li>
<li>
<strong>Key Combination</strong>: Public key shares are combined into a Collective Public Key (CPK). Encryption under the CPK requires ALL servers for decryption.</li>
<li>
<strong>Encryption</strong>: Each server standardizes its data (Z-scores) and encrypts columns under the CPK.</li>
<li>
<strong>Local Correlation</strong>: Within-server correlations are computed in plaintext.</li>
<li>
<strong>Cross-Server Correlation (share-wrapped threshold decryption)</strong>: For each server pair (A, B): server A computes Z_A * Enc(Z_B) homomorphically. Each server produces a partial decryption share, <strong>wrapped</strong> (transport-encrypted) under the fusion server’s X25519 public key. The client relays these opaque wrapped shares to the fusion server (party 0). The fusion server unwraps all shares, computes its own share, and returns only the final aggregate scalar. The client <strong>never</strong> sees raw partial shares.</li>
<li>
<strong>Assembly</strong>: The full p x p correlation matrix is assembled from local and cross-server blocks.</li>
</ol>
</div>
<div class="section level2">
<h2 id="glm-secure-routing-coordinator-model">GLM Secure Routing (Coordinator Model)<a class="anchor" aria-label="anchor" href="#glm-secure-routing-coordinator-model"></a>
</h2>
<p>The GLM protocol uses a <strong>coordinator model</strong> so that individual-level vectors never pass through the client:</p>
<table class="table">
<colgroup>
<col width="26%">
<col width="73%">
</colgroup>
<thead><tr>
<th>Role</th>
<th>Responsibilities</th>
</tr></thead>
<tbody>
<tr>
<td><strong>Label server (coordinator)</strong></td>
<td>Runs the IRLS loop. Encrypts individual-level vectors (mu, w, v) under each non-label server’s public key and sends the ciphertexts through the client as opaque blobs.</td>
</tr>
<tr>
<td><strong>Non-label servers</strong></td>
<td>Decrypt locally, compute their gradient contribution (X_k’ W v), encrypt eta_k for the coordinator.</td>
</tr>
<tr>
<td><strong>Client (blind relay)</strong></td>
<td>Routes opaque encrypted blobs between servers. Sees only p_k-length coefficient vectors (public model output) and encrypted payloads it cannot decrypt.</td>
</tr>
</tbody>
</table>
<p>This ensures the client acts as a transport layer with no access to observation-level information.</p>
</div>
<div class="section level2">
<h2 id="supported-glm-families">Supported GLM Families<a class="anchor" aria-label="anchor" href="#supported-glm-families"></a>
</h2>
<table class="table">
<thead><tr>
<th>Family</th>
<th>Link</th>
<th>Use Case</th>
</tr></thead>
<tbody>
<tr>
<td><code>gaussian</code></td>
<td>Identity</td>
<td>Continuous outcomes (linear regression)</td>
</tr>
<tr>
<td><code>binomial</code></td>
<td>Logit</td>
<td>Binary outcomes (logistic regression)</td>
</tr>
<tr>
<td><code>poisson</code></td>
<td>Log</td>
<td>Count data</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="chunked-transfer-protocol">Chunked Transfer Protocol<a class="anchor" aria-label="anchor" href="#chunked-transfer-protocol"></a>
</h2>
<p>DataSHIELD’s R expression parser limits the size of arguments that can be passed inline in <code><a href="https://rdrr.io/r/base/call.html" class="external-link">call()</a></code> expressions. Cryptographic objects (CKKS ciphertexts, EC points, key shares, transport-encrypted blobs) routinely exceed this limit. dsVertClient automatically splits all large payloads into 10 KB chunks via <code>mheStoreBlobDS</code>, which the server reassembles transparently. This chunking is applied uniformly across all protocols (PSI, MHE correlation, GLM) for any data that scales with the number of observations, variables, or servers — ensuring that no DataSHIELD call can overflow regardless of dataset size or number of parties.</p>
</div>
<div class="section level2">
<h2 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h2>
<ul>
<li>R &gt;= 4.0.0</li>
<li>DSI package</li>
<li>jsonlite package</li>
<li>dsVert package installed on DataSHIELD servers (Opal/Rock)</li>
</ul>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<ul>
<li>
<a href="https://isglobal-brge.github.io/dsVertClient/articles/pima-demo.html">Pima Validation Demo</a>: Full pipeline validation against centralized R</li>
</ul>
</div>
<div class="section level2">
<h2 id="authors">Authors<a class="anchor" aria-label="anchor" href="#authors"></a>
</h2>
<ul>
<li>David Sarrat Gonzalez</li>
<li>Miron Banjac</li>
<li>Juan R Gonzalez</li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>De Cristofaro, E. &amp; Tsudik, G. (2010). “Practical Private Set Intersection Protocols with Linear Complexity”. <em>FC 2010</em>.</li>
<li>Mouchet, C. et al. (2021). “Multiparty Homomorphic Encryption from Ring-Learning-With-Errors”. <em>Proceedings on Privacy Enhancing Technologies (PETS)</em>.</li>
<li>Cheon, J.H. et al. (2017). “Homomorphic Encryption for Arithmetic of Approximate Numbers”. <em>ASIACRYPT 2017</em>.</li>
<li>van Kesteren, E.J. et al. (2019). “Privacy-preserving generalized linear models using distributed block coordinate descent”. arXiv:1911.03183.</li>
<li>Lattigo v6: <a href="https://github.com/tuneinsight/lattigo" class="external-link uri">https://github.com/tuneinsight/lattigo</a>
</li>
</ul>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/isglobal-brge/dsVertClient/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/isglobal-brge/dsVertClient/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://github.com/davidsarratgonzalez" class="external-link">David Sarrat González</a> <br><small class="roles"> Author, maintainer </small>   </li>
<li>
<a href="https://github.com/mironbanjac" class="external-link">Miron Banjac</a> <br><small class="roles"> Author </small>   </li>
<li>
<a href="https://github.com/isglobal-brge" class="external-link">Juan R González</a> <br><small class="roles"> Author </small>   </li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

<div class="pkgdown-footer-right">

</div>

    </footer>
</div>





  </body>
</html>
