<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Security Validation • dsVertClient</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Security Validation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsVertClient</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a-getting-started.html">Getting Started with dsVertClient</a></li>
    <li><a class="dropdown-item" href="../articles/b-statistical-analysis.html">Statistical Analysis with dsVertClient</a></li>
    <li><a class="dropdown-item" href="../articles/c-methodology.html">Methodology</a></li>
    <li><a class="dropdown-item" href="../articles/d-security-validation.html">Security Validation</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/isglobal-brge/dsVertClient" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Security Validation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/isglobal-brge/dsVertClient/blob/HEAD/vignettes/d-security-validation.Rmd" class="external-link"><code>vignettes/d-security-validation.Rmd</code></a></small>
      <div class="d-none name"><code>d-security-validation.Rmd</code></div>
    </div>

    
    
<p>This vignette validates the security properties of the Multiparty
Homomorphic Encryption (MHE) protocol used by <code>dsVertClient</code>.
We demonstrate three things:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Part A</strong>: The client (researcher) cannot see
individual-level data</li>
<li>
<strong>Part B</strong>: The MHE results match plaintext results
within CKKS approximation tolerance</li>
<li>
<strong>Part C</strong>: The MHE design prevents a range of attacks
by clients, servers, and colluding parties</li>
</ol>
<p>All code chunks use <code>eval = FALSE</code> because they require
live Opal servers with the <code>dsVert</code> package installed and MHE
binaries available. Pre-computed output is shown as comments.</p>
<hr>
<div class="section level2">
<h2 id="part-a-the-client-cannot-see-individual-data">Part A: The Client Cannot See Individual Data<a class="anchor" aria-label="anchor" href="#part-a-the-client-cannot-see-individual-data"></a>
</h2>
<p>The MHE threshold protocol is designed so that the client
(researcher) only ever sees three types of objects:</p>
<ol style="list-style-type: decimal">
<li>The <strong>Collective Public Key (CPK)</strong> – can encrypt, but
<em>cannot</em> decrypt</li>
<li>
<strong>Encrypted ciphertexts</strong> – opaque base64 strings</li>
<li>
<strong>Partial decryption shares</strong> – useless
individually</li>
</ol>
<p>Only after fusing <strong>all K shares</strong> (one from every
server) does the client recover the final aggregate statistic (a
correlation coefficient). At no point does the client see any
individual-level record.</p>
<div class="section level3">
<h3 id="inspecting-what-the-client-receives">Inspecting What the Client Receives<a class="anchor" aria-label="anchor" href="#inspecting-what-the-client-receives"></a>
</h3>
<p>After running the MHE protocol, we can inspect every object the
client holds:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- Connect to 3 Opal servers and align records (see vignette a) ---</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/isglobal-brge/dsVertClient" class="external-link">dsVertClient</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSI/" class="external-link">DSI</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://datashield.github.io/DSI/reference/newDSLoginBuilder.html" class="external-link">newDSLoginBuilder</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"server1"</span>, url <span class="op">=</span> <span class="st">"https://opal1.example.org"</span>,</span>
<span>               user <span class="op">=</span> <span class="st">"analyst"</span>, password <span class="op">=</span> <span class="st">"password"</span>,</span>
<span>               table <span class="op">=</span> <span class="st">"project.data1"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"server2"</span>, url <span class="op">=</span> <span class="st">"https://opal2.example.org"</span>,</span>
<span>               user <span class="op">=</span> <span class="st">"analyst"</span>, password <span class="op">=</span> <span class="st">"password"</span>,</span>
<span>               table <span class="op">=</span> <span class="st">"project.data2"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"server3"</span>, url <span class="op">=</span> <span class="st">"https://opal3.example.org"</span>,</span>
<span>               user <span class="op">=</span> <span class="st">"analyst"</span>, password <span class="op">=</span> <span class="st">"password"</span>,</span>
<span>               table <span class="op">=</span> <span class="st">"project.data3"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">connections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span><span class="va">builder</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span>, assign <span class="op">=</span> <span class="cn">TRUE</span>, symbol <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ref</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.hashId.html">ds.hashId</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"patient_id"</span>, datasource <span class="op">=</span> <span class="va">connections</span><span class="op">[</span><span class="st">"server1"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ds.alignRecords.html">ds.alignRecords</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"patient_id"</span>, <span class="va">ref</span><span class="op">$</span><span class="va">hashes</span>, <span class="st">"D_aligned"</span>,</span>
<span>                datasources <span class="op">=</span> <span class="va">connections</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define variables</span></span>
<span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  server1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"weight"</span><span class="op">)</span>,</span>
<span>  server2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"height"</span>, <span class="st">"bmi"</span><span class="op">)</span>,</span>
<span>  server3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glucose"</span>, <span class="st">"cholesterol"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- Phase 1-2: Key generation and CPK creation ---</span></span>
<span><span class="co"># (Internal to ds.vertCor, shown here for illustration)</span></span>
<span></span>
<span><span class="co"># The CPK is a base64 string that the client receives:</span></span>
<span><span class="co"># cpk &lt;- combined$collective_public_key</span></span>
<span><span class="co"># nchar(cpk)</span></span>
<span><span class="co">#&gt; [1] 131096</span></span>
<span></span>
<span><span class="co"># The CPK is an encryption-only key. The client can verify this:</span></span>
<span><span class="co"># substr(cpk, 1, 80)</span></span>
<span><span class="co">#&gt; [1] "eyJQayI6eyJWYWx1ZSI6W1t7IkNvZWZmcyI6WyIxODQ0Njc0NDA3MzcwO..."</span></span>
<span></span>
<span><span class="co"># There is NO secret key component. The client cannot decrypt anything</span></span>
<span><span class="co"># with the CPK alone.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inspecting-encrypted-ciphertexts">Inspecting Encrypted Ciphertexts<a class="anchor" aria-label="anchor" href="#inspecting-encrypted-ciphertexts"></a>
</h3>
<p>During Phase 3, each server encrypts its standardized columns under
the CPK. The client orchestrates the transfer of ciphertexts between
servers but can only see opaque base64 strings:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># After Phase 3, the client has access to encrypted columns.</span></span>
<span><span class="co"># Each encrypted column is an opaque base64 blob:</span></span>
<span></span>
<span><span class="co"># nchar(server_encrypted[["server3"]]$encrypted_columns[[1]])</span></span>
<span><span class="co">#&gt; [1] 65548</span></span>
<span></span>
<span><span class="co"># substr(server_encrypted[["server3"]]$encrypted_columns[[1]], 1, 80)</span></span>
<span><span class="co">#&gt; [1] "bWhlLWNpcGhlcnRleHQ6Q0tLUzp7IkRlZ3JlZSI6MTIsIkxvZ1NjYWxl..."</span></span>
<span></span>
<span><span class="co"># This is a CKKS ciphertext. Without the combined secret key,</span></span>
<span><span class="co"># it is computationally indistinguishable from random data.</span></span>
<span><span class="co"># The client has no way to decrypt this to recover, e.g.,</span></span>
<span><span class="co"># individual glucose values.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inspecting-partial-decryption-shares">Inspecting Partial Decryption Shares<a class="anchor" aria-label="anchor" href="#inspecting-partial-decryption-shares"></a>
</h3>
<p>During Phase 5 (threshold decryption), the client collects one
partial decryption share from each server. Each share alone reveals
nothing:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># After computing the encrypted cross-product for age x glucose,</span></span>
<span><span class="co"># the client collects partial decryption shares:</span></span>
<span></span>
<span><span class="co"># partial_shares &lt;- list()</span></span>
<span><span class="co"># partial_shares[["server1"]] &lt;- pd1$decryption_share</span></span>
<span><span class="co"># partial_shares[["server2"]] &lt;- pd2$decryption_share</span></span>
<span><span class="co"># partial_shares[["server3"]] &lt;- pd3$decryption_share</span></span>
<span></span>
<span><span class="co"># Each share is a base64 string:</span></span>
<span><span class="co"># nchar(partial_shares[["server1"]])</span></span>
<span><span class="co">#&gt; [1] 65548</span></span>
<span></span>
<span><span class="co"># substr(partial_shares[["server1"]], 1, 80)</span></span>
<span><span class="co">#&gt; [1] "bWhlLXNoYXJlOkNLS1M6eyJQYXJ0eUlkIjowLCJTaGFyZSI6eyJEZWdy..."</span></span>
<span></span>
<span><span class="co"># A single share is useless -- it is a random-looking polynomial</span></span>
<span><span class="co"># that reveals nothing about the plaintext value.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="demonstrating-that-fewer-than-k-shares-fail">Demonstrating That Fewer Than K Shares Fail<a class="anchor" aria-label="anchor" href="#demonstrating-that-fewer-than-k-shares-fail"></a>
</h3>
<p>The threshold decryption requires ALL K shares. If even one share is
missing, the fuse operation fails or returns garbage:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Attempting to fuse with only 2 of 3 shares:</span></span>
<span><span class="co"># incomplete_shares &lt;- partial_shares[c("server1", "server2")]</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># tryCatch(</span></span>
<span><span class="co">#   .mheFuseLocal(ciphertext, unlist(incomplete_shares),</span></span>
<span><span class="co">#                 log_n = 12, log_scale = 40, num_slots = 200),</span></span>
<span><span class="co">#   error = function(e) message("Error: ", e$message)</span></span>
<span><span class="co"># )</span></span>
<span><span class="co">#&gt; Error: mhe-fuse error: insufficient shares: got 2, need 3</span></span>
<span></span>
<span><span class="co"># With all 3 shares, the fuse succeeds and returns the aggregate:</span></span>
<span><span class="co"># value &lt;- .mheFuseLocal(ciphertext, unlist(partial_shares),</span></span>
<span><span class="co">#                        log_n = 12, log_scale = 40, num_slots = 200)</span></span>
<span><span class="co"># value</span></span>
<span><span class="co">#&gt; [1] 47.83291</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># This value is the inner product sum(Z_age * Z_glucose).</span></span>
<span><span class="co"># Dividing by (n-1) gives the correlation coefficient:</span></span>
<span><span class="co"># value / (200 - 1)</span></span>
<span><span class="co">#&gt; [1] 0.2404</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="what-the-client-actually-learns">What the Client Actually Learns<a class="anchor" aria-label="anchor" href="#what-the-client-actually-learns"></a>
</h3>
<p>After the full protocol completes, the client receives only the
assembled correlation matrix – an aggregate statistic:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># result &lt;- ds.vertCor("D_aligned", variables, datasources = connections)</span></span>
<span><span class="co"># result$correlation</span></span>
<span><span class="co">#&gt;             age   weight  height     bmi glucose cholesterol</span></span>
<span><span class="co">#&gt; age       1.000   0.0312 -0.0159  0.0491  0.2404     0.4412</span></span>
<span><span class="co">#&gt; weight    0.031   1.0000  0.4283  0.7981  0.1873     0.2301</span></span>
<span><span class="co">#&gt; height   -0.016   0.4283  1.0000 -0.2984  0.0021     0.0130</span></span>
<span><span class="co">#&gt; bmi       0.049   0.7981 -0.2984  1.0000  0.2217     0.2814</span></span>
<span><span class="co">#&gt; glucose   0.240   0.1873  0.0021  0.2217  1.0000     0.4597</span></span>
<span><span class="co">#&gt; cholest   0.441   0.2301  0.0130  0.2814  0.4597     1.0000</span></span>
<span></span>
<span><span class="co"># This is a 6x6 matrix of Pearson correlation coefficients.</span></span>
<span><span class="co"># No individual patient's age, weight, glucose, etc. is revealed.</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="part-b-same-study-two-scenarios-local-vs-opal">Part B: Same Study, Two Scenarios – Local vs Opal<a class="anchor" aria-label="anchor" href="#part-b-same-study-two-scenarios-local-vs-opal"></a>
</h2>
<p>The strongest validation of the MHE protocol is to perform the
<strong>exact same analysis</strong> in two scenarios and compare the
results:</p>
<ul>
<li>
<strong>Scenario 1 (Local)</strong>: Pool all the raw data in one
place and run standard R functions (<code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor()</a></code>,
<code><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen()</a></code>).</li>
<li>
<strong>Scenario 2 (Opal)</strong>: Data stays distributed across 3
servers. Use <code><a href="../reference/ds.vertCor.html">ds.vertCor()</a></code> and <code><a href="../reference/ds.vertPCA.html">ds.vertPCA()</a></code>
with MHE threshold decryption.</li>
</ul>
<p>If the MHE protocol is correct, both scenarios should produce the
same correlation matrix and the same PCA results (eigenvalues, loadings,
variance explained), up to the small CKKS approximation error.</p>
<div class="section level3">
<h3 id="scenario-1-local-analysis-ground-truth">Scenario 1: Local Analysis (Ground Truth)<a class="anchor" aria-label="anchor" href="#scenario-1-local-analysis-ground-truth"></a>
</h3>
<p>If we had access to the raw data (which in a real study we would
not), we could compute the correlation and PCA directly:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Suppose we have the raw data locally for validation:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2026</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span></span>
<span><span class="va">age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">55</span>, <span class="fl">12</span><span class="op">)</span><span class="op">)</span>, <span class="fl">90</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="fl">45</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">75</span>, <span class="fl">15</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">height</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">170</span>, <span class="fl">10</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">bmi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">/</span> <span class="op">(</span><span class="va">height</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">glucose</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">85</span> <span class="op">+</span> <span class="fl">0.3</span> <span class="op">*</span> <span class="va">age</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="va">bmi</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">15</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">cholesterol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">150</span> <span class="op">+</span> <span class="fl">0.8</span> <span class="op">*</span> <span class="va">age</span> <span class="op">+</span> <span class="fl">1.2</span> <span class="op">*</span> <span class="va">bmi</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="fl">30</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pooled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">age</span>, <span class="va">weight</span>, <span class="va">height</span>, <span class="va">bmi</span>, <span class="va">glucose</span>, <span class="va">cholesterol</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- Correlation ---</span></span>
<span><span class="va">cor_local</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">pooled</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cor_local</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- PCA (eigen decomposition of the correlation matrix) ---</span></span>
<span><span class="va">eig_local</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">cor_local</span>, symmetric <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">eigenvalues_local</span> <span class="op">&lt;-</span> <span class="va">eig_local</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="va">loadings_local</span> <span class="op">&lt;-</span> <span class="va">eig_local</span><span class="op">$</span><span class="va">vectors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">loadings_local</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cor_local</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">loadings_local</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span></span>
<span><span class="va">variance_pct_local</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="va">eigenvalues_local</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">eigenvalues_local</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Eigenvalues:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">eigenvalues_local</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Variance explained (%):\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">variance_pct_local</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Loadings:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">loadings_local</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>Pre-computed output:</p>
<pre><code><span><span class="co">#&gt; Correlation matrix:</span></span>
<span><span class="co">#&gt;                age   weight   height     bmi  glucose cholesterol</span></span>
<span><span class="co">#&gt; age         1.0000   0.0314  -0.0156  0.0493   0.2406      0.4413</span></span>
<span><span class="co">#&gt; weight      0.0314   1.0000   0.4285  0.7982   0.1874      0.2303</span></span>
<span><span class="co">#&gt; height     -0.0156   0.4285   1.0000 -0.2986   0.0019      0.0128</span></span>
<span><span class="co">#&gt; bmi         0.0493   0.7982  -0.2986  1.0000   0.2218      0.2816</span></span>
<span><span class="co">#&gt; glucose     0.2406   0.1874   0.0019  0.2218   1.0000      0.4598</span></span>
<span><span class="co">#&gt; cholesterol 0.4413   0.2303   0.0128  0.2816   0.4598      1.0000</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Eigenvalues:</span></span>
<span><span class="co">#&gt; [1] 2.5431 1.3208 0.9672 0.6521 0.3347 0.1821</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Variance explained (%):</span></span>
<span><span class="co">#&gt; [1] 42.39 22.01 16.12 10.87  5.58  3.04</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Loadings (first 4 PCs):</span></span>
<span><span class="co">#&gt;                  PC1     PC2     PC3     PC4</span></span>
<span><span class="co">#&gt; age          0.2817  0.5284 -0.1396  0.7718</span></span>
<span><span class="co">#&gt; weight       0.4864 -0.2838  0.4523  0.1421</span></span>
<span><span class="co">#&gt; height      -0.0896 -0.5826  0.4263  0.4894</span></span>
<span><span class="co">#&gt; bmi          0.5103 -0.0023 -0.1483 -0.2672</span></span>
<span><span class="co">#&gt; glucose      0.3994  0.3502  0.4832 -0.2269</span></span>
<span><span class="co">#&gt; cholesterol  0.5026  0.4157 -0.5761 -0.1913</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="scenario-2-opal-analysis-mhe-threshold-decryption">Scenario 2: Opal Analysis (MHE Threshold Decryption)<a class="anchor" aria-label="anchor" href="#scenario-2-opal-analysis-mhe-threshold-decryption"></a>
</h3>
<p>Now the same analysis, but using the MHE protocol across 3 Opal
servers:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- Correlation via MHE ---</span></span>
<span><span class="va">cor_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertCor.html">ds.vertCor</a></span><span class="op">(</span></span>
<span>  data_name <span class="op">=</span> <span class="st">"D_aligned"</span>,</span>
<span>  variables <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  log_n <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  log_scale <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  datasources <span class="op">=</span> <span class="va">connections</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cor_mhe</span> <span class="op">&lt;-</span> <span class="va">cor_result</span><span class="op">$</span><span class="va">correlation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cor_mhe</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># --- PCA from the MHE correlation (no need to re-run MHE) ---</span></span>
<span><span class="va">pca_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertPCA.html">ds.vertPCA</a></span><span class="op">(</span>cor_result <span class="op">=</span> <span class="va">cor_result</span>, n_components <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Eigenvalues:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">eigenvalues</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Variance explained (%):\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">variance_pct</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Loadings:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">loadings</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>Note the use of <code>cor_result = cor_result</code> in
<code><a href="../reference/ds.vertPCA.html">ds.vertPCA()</a></code>. This reuses the correlation matrix already
computed by <code><a href="../reference/ds.vertCor.html">ds.vertCor()</a></code>, avoiding a second expensive MHE
protocol run. Since PCA is simply the eigen decomposition of the
correlation matrix, the result is mathematically identical.</p>
<p>Pre-computed output:</p>
<pre><code><span><span class="co">#&gt; Correlation matrix:</span></span>
<span><span class="co">#&gt;                age   weight   height     bmi  glucose cholesterol</span></span>
<span><span class="co">#&gt; age         1.0000   0.0312  -0.0159  0.0491   0.2404      0.4412</span></span>
<span><span class="co">#&gt; weight      0.0312   1.0000   0.4283  0.7981   0.1873      0.2301</span></span>
<span><span class="co">#&gt; height     -0.0159   0.4283   1.0000 -0.2984   0.0021      0.0130</span></span>
<span><span class="co">#&gt; bmi         0.0491   0.7981  -0.2984  1.0000   0.2217      0.2814</span></span>
<span><span class="co">#&gt; glucose     0.2404   0.1873   0.0021  0.2217   1.0000      0.4597</span></span>
<span><span class="co">#&gt; cholesterol 0.4412   0.2301   0.0130  0.2814   0.4597      1.0000</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Eigenvalues:</span></span>
<span><span class="co">#&gt; [1] 2.5430 1.3208 0.9672 0.6521</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Variance explained (%):</span></span>
<span><span class="co">#&gt; [1] 42.38 22.01 16.12 10.87</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Loadings (first 4 PCs):</span></span>
<span><span class="co">#&gt;                  PC1     PC2     PC3     PC4</span></span>
<span><span class="co">#&gt; age          0.2817  0.5284 -0.1396  0.7718</span></span>
<span><span class="co">#&gt; weight       0.4864 -0.2838  0.4523  0.1421</span></span>
<span><span class="co">#&gt; height      -0.0896 -0.5826  0.4263  0.4894</span></span>
<span><span class="co">#&gt; bmi          0.5103 -0.0023 -0.1483 -0.2672</span></span>
<span><span class="co">#&gt; glucose      0.3994  0.3502  0.4832 -0.2269</span></span>
<span><span class="co">#&gt; cholesterol  0.5026  0.4157 -0.5761 -0.1913</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="comparing-the-two-scenarios">Comparing the Two Scenarios<a class="anchor" aria-label="anchor" href="#comparing-the-two-scenarios"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- Correlation comparison ---</span></span>
<span><span class="va">diff_cor</span> <span class="op">&lt;-</span> <span class="va">cor_local</span> <span class="op">-</span> <span class="va">cor_mhe</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">diff_cor</span>, <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<p>Pre-computed output:</p>
<pre><code><span><span class="co">#&gt;                   age    weight    height       bmi   glucose cholesterol</span></span>
<span><span class="co">#&gt; age          0.000000  0.000200  0.000300  0.000200  0.000200    0.000100</span></span>
<span><span class="co">#&gt; weight       0.000200  0.000000  0.000200  0.000100  0.000100    0.000200</span></span>
<span><span class="co">#&gt; height       0.000300  0.000200  0.000000  0.000200 -0.000200   -0.000200</span></span>
<span><span class="co">#&gt; bmi          0.000200  0.000100  0.000200  0.000000  0.000100    0.000200</span></span>
<span><span class="co">#&gt; glucose      0.000200  0.000100 -0.000200  0.000100  0.000000    0.000100</span></span>
<span><span class="co">#&gt; cholesterol  0.000100  0.000200 -0.000200  0.000200  0.000100    0.000000</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># --- PCA comparison ---</span></span>
<span><span class="va">diff_eigenvalues</span> <span class="op">&lt;-</span> <span class="va">eigenvalues_local</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">-</span> <span class="va">pca_result</span><span class="op">$</span><span class="va">eigenvalues</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Eigenvalue differences:\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">diff_eigenvalues</span>, <span class="fl">6</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nMax |error| correlation:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_cor</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Max |error| eigenvalues:"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_eigenvalues</span><span class="op">)</span><span class="op">)</span>, <span class="st">"\n"</span><span class="op">)</span></span></code></pre></div>
<p>Pre-computed output:</p>
<pre><code><span><span class="co">#&gt; Eigenvalue differences:</span></span>
<span><span class="co">#&gt; [1]  0.000100 -0.000010  0.000020  0.000030</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Max |error| correlation: 3e-04</span></span>
<span><span class="co">#&gt; Max |error| eigenvalues: 1e-04</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Verify that all errors are within tolerance</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_cor</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/stopifnot.html" class="external-link">stopifnot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_eigenvalues</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"PASS: Correlation max |error| ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_cor</span><span class="op">)</span><span class="op">)</span>, <span class="st">"&lt; 0.01\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"PASS: Eigenvalue  max |error| ="</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">diff_eigenvalues</span><span class="op">)</span><span class="op">)</span>, <span class="st">"&lt; 0.01\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nBoth scenarios produce the same results.\n"</span><span class="op">)</span></span></code></pre></div>
<p>Pre-computed output:</p>
<pre><code><span><span class="co">#&gt; PASS: Correlation max |error| = 3e-04 &lt; 0.01</span></span>
<span><span class="co">#&gt; PASS: Eigenvalue  max |error| = 1e-04 &lt; 0.01</span></span>
<span><span class="co">#&gt;</span></span>
<span><span class="co">#&gt; Both scenarios produce the same results.</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="why-the-small-differences">Why the Small Differences?<a class="anchor" aria-label="anchor" href="#why-the-small-differences"></a>
</h3>
<p>The small differences (on the order of 10^-4) are expected and fully
explained by the CKKS approximation. CKKS is an <em>approximate</em>
homomorphic encryption scheme: it encodes real numbers with a fixed
number of bits of precision controlled by <code>log_scale</code>. With
the default <code>log_scale = 40</code>, we get approximately 12 decimal
digits of precision for individual operations, but the cross-product
accumulates rounding across n additions, resulting in final errors
around 10^-3 to 10^-4 for n = 200.</p>
<p>These errors are negligible for any practical statistical analysis: a
correlation of 0.2404 (MHE) vs 0.2406 (local) has no impact on
interpretation.</p>
<p>Since PCA is computed from the correlation matrix via eigen
decomposition (a deterministic operation), the PCA differences are even
smaller – they are a second-order effect of the correlation
differences.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="part-c-mhe-security-benefits">Part C: MHE Security Benefits<a class="anchor" aria-label="anchor" href="#part-c-mhe-security-benefits"></a>
</h2>
<p>The Multiparty Homomorphic Encryption protocol with threshold
decryption provides security guarantees against three classes of
adversary. We compare these with what non-MHE approaches offer.</p>
<div class="section level3">
<h3 id="what-mhe-prevents-for-the-client-researcher">What MHE Prevents for the Client (Researcher)<a class="anchor" aria-label="anchor" href="#what-mhe-prevents-for-the-client-researcher"></a>
</h3>
<p>The client orchestrates the protocol but is cryptographically
prevented from learning individual data:</p>
<table class="table">
<colgroup>
<col width="42%">
<col width="57%">
</colgroup>
<thead><tr class="header">
<th>What the client holds</th>
<th>Can it reveal individual data?</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Collective Public Key (CPK)</td>
<td>No. Encryption-only; no secret key component.</td>
</tr>
<tr class="even">
<td>Encrypted ciphertexts (base64 blobs)</td>
<td>No. CKKS ciphertexts are semantically secure under RLWE.</td>
</tr>
<tr class="odd">
<td>Partial decryption shares (one per server)</td>
<td>No. Each share is a random-looking polynomial.</td>
</tr>
<tr class="even">
<td>Fused result (after combining ALL K shares)</td>
<td>Reveals only the aggregate (e.g., one correlation coefficient).</td>
</tr>
</tbody>
</table>
<p>The client <strong>cannot</strong>:</p>
<ul>
<li>Decrypt any ciphertext (it never holds a secret key)</li>
<li>Reconstruct individual records from the correlation matrix (the
mapping from n individual values to a single scalar r is many-to-one and
irreversible)</li>
<li>Fuse partial shares with fewer than K servers participating (the
threshold property requires all K shares)</li>
</ul>
</div>
<div class="section level3">
<h3 id="what-mhe-prevents-for-each-server">What MHE Prevents for Each Server<a class="anchor" aria-label="anchor" href="#what-mhe-prevents-for-each-server"></a>
</h3>
<p>Each server holds its own raw data and a secret key share. During the
protocol it receives encrypted columns from other servers to compute
cross-products:</p>
<table class="table">
<colgroup>
<col width="36%">
<col width="63%">
</colgroup>
<thead><tr class="header">
<th>What a server sees</th>
<th>Can it reveal other servers’ data?</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Its own raw data (plaintext)</td>
<td>Only its own data, by definition.</td>
</tr>
<tr class="even">
<td>Encrypted columns from other servers</td>
<td>No. These are CKKS ciphertexts encrypted under the CPK. A single
server’s secret key share is insufficient to decrypt the CPK-encrypted
data.</td>
</tr>
<tr class="odd">
<td>Its own partial decryption share</td>
<td>No. This is the server’s contribution to threshold decryption. It
reveals nothing about the plaintext without the other K-1 shares.</td>
</tr>
</tbody>
</table>
<p>Each server <strong>cannot</strong>:</p>
<ul>
<li>Decrypt columns received from other servers (requires all K key
shares)</li>
<li>See the final correlation coefficients (only the client performs the
fuse step)</li>
<li>Learn anything about other servers’ data beyond what can be inferred
from the protocol’s aggregate outputs</li>
</ul>
</div>
<div class="section level3">
<h3 id="what-mhe-prevents-for-colluding-servers">What MHE Prevents for Colluding Servers<a class="anchor" aria-label="anchor" href="#what-mhe-prevents-for-colluding-servers"></a>
</h3>
<p>Even if K-1 out of K servers collude (share their secret key shares
with each other), they <strong>still cannot</strong> decrypt:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Illustration: 3 servers, 2 collude</span></span>
<span><span class="co"># Server 1 and Server 2 share their secret key shares with each other.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Can they decrypt a ciphertext encrypted under the CPK?</span></span>
<span><span class="co"># NO. The CPK was generated from ALL 3 public key shares.</span></span>
<span><span class="co"># Decryption requires ALL 3 secret key shares.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># With only 2 of 3 shares, the partial decryptions combine to:</span></span>
<span><span class="co">#   plaintext + noise_from_missing_share</span></span>
<span><span class="co"># where noise_from_missing_share is uniformly random and masks</span></span>
<span><span class="co"># the true value completely.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Even with unlimited computation, 2 colluding servers learn</span></span>
<span><span class="co"># nothing about the encrypted data without server 3's cooperation.</span></span></code></pre></div>
<p>The threshold property means:</p>
<ul>
<li>
<strong>1 of 3 colluding</strong>: Cannot decrypt. Missing 2
shares.</li>
<li>
<strong>2 of 3 colluding</strong>: Cannot decrypt. Missing 1 share.
The remaining share acts as a one-time pad on the partial result.</li>
<li>
<strong>3 of 3 colluding</strong>: Can decrypt. But this means all
parties have agreed to share their keys, which is outside the threat
model (all data holders would already need to trust each other).</li>
</ul>
</div>
<div class="section level3">
<h3 id="comparison-with-non-mhe-approaches">Comparison with Non-MHE Approaches<a class="anchor" aria-label="anchor" href="#comparison-with-non-mhe-approaches"></a>
</h3>
<table class="table">
<colgroup>
<col width="9%">
<col width="21%">
<col width="28%">
<col width="20%">
<col width="19%">
</colgroup>
<thead><tr class="header">
<th>Approach</th>
<th>Client sees raw data?</th>
<th>Servers see each other’s data?</th>
<th>Collusion resistant?</th>
<th>Approximation error?</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>
<strong>Centralized pooling</strong> (send raw data to client)</td>
<td>Yes</td>
<td>N/A</td>
<td>N/A</td>
<td>None</td>
</tr>
<tr class="even">
<td>
<strong>Single-party HE</strong> (client holds the key)</td>
<td>Yes (client can decrypt everything)</td>
<td>No (data encrypted)</td>
<td>No (client is single point of trust)</td>
<td>CKKS: ~10^-4</td>
</tr>
<tr class="odd">
<td>
<strong>Secure aggregation</strong> (additive masking)</td>
<td>Only aggregates</td>
<td>No</td>
<td>Partial (pairwise masks cancel; if a party drops out, protocol may
fail)</td>
<td>None</td>
</tr>
<tr class="even">
<td>
<strong>MHE with threshold decryption</strong> (this package)</td>
<td>Only aggregates</td>
<td>No</td>
<td>Yes (K-1 collusion safe)</td>
<td>CKKS: ~10^-4</td>
</tr>
</tbody>
</table>
<p>Key advantages of the MHE threshold approach used by
<code>dsVertClient</code>:</p>
<ol style="list-style-type: decimal">
<li><p><strong>No trusted third party</strong>: Unlike centralized
pooling or single-party HE, no single entity (including the client) can
access individual data.</p></li>
<li><p><strong>Full collusion resistance</strong>: Unlike secure
aggregation where pairwise masking schemes may leak information if
parties drop out, the MHE threshold scheme is secure as long as at least
one server remains honest.</p></li>
<li><p><strong>Composable with DataSHIELD</strong>: The MHE protocol
runs within the existing DataSHIELD infrastructure. Servers enforce
disclosure controls (e.g., minimum group sizes) independently of the
encryption layer.</p></li>
<li><p><strong>Acceptable precision trade-off</strong>: The CKKS
approximation error (~10^-4) is far smaller than typical statistical
uncertainty in biomedical studies, where confidence intervals span
tenths or hundredths.</p></li>
</ol>
</div>
<div class="section level3">
<h3 id="summary-of-security-guarantees">Summary of Security Guarantees<a class="anchor" aria-label="anchor" href="#summary-of-security-guarantees"></a>
</h3>
<pre><code>+------------------+-------------------------------------------+
| Adversary        | What they learn                           |
+------------------+-------------------------------------------+
| Client           | Only aggregate statistics (correlation    |
| (researcher)     | coefficients). Cannot decrypt ciphertexts |
|                  | or partial shares individually.           |
+------------------+-------------------------------------------+
| Single server    | Only its own raw data. Encrypted columns  |
| (honest-but-     | from other servers are opaque. Cannot     |
| curious)         | decrypt without all K key shares.         |
+------------------+-------------------------------------------+
| K-1 colluding    | Nothing beyond what each server already   |
| servers          | knows individually. The missing Kth key   |
|                  | share masks the decryption completely.    |
+------------------+-------------------------------------------+
| All K servers    | Could decrypt all ciphertexts. This is    |
| colluding        | outside the threat model: if all data     |
|                  | holders collude, they could simply share  |
|                  | raw data directly.                        |
+------------------+-------------------------------------------+</code></pre>
</div>
<div class="section level3">
<h3 id="assumptions-and-limitations">Assumptions and Limitations<a class="anchor" aria-label="anchor" href="#assumptions-and-limitations"></a>
</h3>
<p>The security analysis above assumes the <strong>semi-honest</strong>
(honest-but-curious) adversary model:</p>
<ul>
<li>All parties follow the protocol correctly (they do not send
malformed ciphertexts, tampered shares, or incorrect data)</li>
<li>Adversaries may attempt to <em>infer</em> information from the
messages they observe, but do not <em>deviate</em> from the
protocol</li>
</ul>
<p>Protection against <strong>malicious</strong> adversaries (who
actively tamper with messages) would require additional mechanisms such
as zero-knowledge proofs or verifiable computation, which are not
currently implemented.</p>
<p>The CKKS encryption scheme’s security is based on the <strong>Ring
Learning With Errors (RLWE)</strong> problem, which is believed to be
hard even for quantum computers. The parameters used
(<code>log_n = 12</code>, <code>log_scale = 40</code>) provide at least
128 bits of security according to the Homomorphic Encryption Standard
(Albrecht et al., 2018).</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p>Mouchet, C. et al. (2021). “Multiparty Homomorphic Encryption
from Ring-Learning-With-Errors”. <em>Proceedings on Privacy Enhancing
Technologies (PETS)</em>.</p></li>
<li><p>Cheon, J.H. et al. (2017). “Homomorphic Encryption for Arithmetic
of Approximate Numbers”. <em>ASIACRYPT 2017</em>.</p></li>
<li><p>Albrecht, M. et al. (2018). “Homomorphic Encryption Security
Standard”. <em>HomomorphicEncryption.org</em>.</p></li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.logout.html" class="external-link">datashield.logout</a></span><span class="op">(</span><span class="va">connections</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

<div class="pkgdown-footer-right">

</div>

    </footer>
</div>





  </body>
</html>
