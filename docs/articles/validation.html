<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Validation Study: Centralized vs. Federated Vertical Analysis • dsVertClient</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Validation Study: Centralized vs. Federated Vertical Analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsVertClient</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.7.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html">Articles</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/isglobal-brge/dsVertClient" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Validation Study: Centralized vs. Federated Vertical Analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/isglobal-brge/dsVertClient/blob/HEAD/vignettes/validation.Rmd" class="external-link"><code>vignettes/validation.Rmd</code></a></small>
      <div class="d-none name"><code>validation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette presents a comparative validation of the dsVert
federated vertical analysis pipeline against centralized R computations.
We exercise the full protocol stack — ECDH-PSI record alignment,
MHE-CKKS correlation, spectral PCA, and encrypted-label GLMs — on real
data vertically partitioned across three DataSHIELD servers.</p>
<p>The study is organized in three parts:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Centralized analysis</strong> — ground truth computed with
standard R functions on the pooled dataset.</li>
<li>
<strong>Federated vertical analysis</strong> — the same analyses
performed via dsVert, where each server holds a different subset of
variables and no raw data leaves any server.</li>
<li>
<strong>Comparative assessment</strong> — side-by-side numerical
comparison with error analysis.</li>
</ol>
<div class="section level3">
<h3 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h3>
<p>We use the Pima Indian women diabetes training set
(<code>Pima.tr</code>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mn>200</mn></mrow><annotation encoding="application/x-tex">n = 200</annotation></semantics></math>)
from the MASS R package (Venables &amp; Ripley, 2002). It contains
clinical measurements for 200 women of Pima heritage aged
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo><mn>21</mn></mrow><annotation encoding="application/x-tex">\geq 21</annotation></semantics></math>
years, collected by the US National Institute of Diabetes and Digestive
and Kidney Diseases near Phoenix, Arizona (Smith et al., 1988). Seven
numeric variables are available: <code>npreg</code> (number of
pregnancies), <code>glu</code> (plasma glucose), <code>bp</code>
(diastolic blood pressure), <code>skin</code> (triceps skin fold
thickness), <code>bmi</code> (body mass index), <code>ped</code>
(diabetes pedigree function), and <code>age</code> (years).</p>
</div>
<div class="section level3">
<h3 id="vertical-partitioning-scheme">Vertical partitioning scheme<a class="anchor" aria-label="anchor" href="#vertical-partitioning-scheme"></a>
</h3>
<p>The data are split across three servers, each representing a
different clinical domain. Row order is independently shuffled per
server so that the ECDH-PSI alignment protocol has real work to do.</p>
<table class="table">
<colgroup>
<col width="11%">
<col width="38%">
<col width="50%">
</colgroup>
<thead><tr class="header">
<th>Server</th>
<th>Domain</th>
<th>Variables</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>server1</td>
<td>Anthropometric / familial</td>
<td>
<code>patient_id</code>, <code>age</code>, <code>bmi</code>,
<code>ped</code>
</td>
</tr>
<tr class="even">
<td>server2</td>
<td>Glucose and cardiovascular</td>
<td>
<code>patient_id</code>, <code>glu</code>, <code>bp</code>,
<code>skin</code>
</td>
</tr>
<tr class="odd">
<td>server3</td>
<td>Reproductive / outcome</td>
<td>
<code>patient_id</code>, <code>npreg</code>,
<code>diabetes</code>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>We load the dataset, create a patient identifier column for PSI
matching, and derive a binary diabetes indicator from the original
factor variable.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/" class="external-link">MASS</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"Pima.tr"</span>, package <span class="op">=</span> <span class="st">"MASS"</span><span class="op">)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">Pima.tr</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">patient_id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"P%03d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">diabetes</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">type</span> <span class="op">==</span> <span class="st">"Yes"</span>, <span class="fl">1L</span>, <span class="fl">0L</span><span class="op">)</span></span>
<span></span>
<span><span class="va">num_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span>, <span class="st">"ped"</span>, <span class="st">"glu"</span>, <span class="st">"bp"</span>, <span class="st">"skin"</span>, <span class="st">"npreg"</span><span class="op">)</span></span></code></pre></div>
<p>A quick look at the data:</p>
<pre><code><span><span class="co">#&gt;       age             bmi             ped              glu       </span></span>
<span><span class="co">#&gt;  Min.   :21.00   Min.   :18.20   Min.   :0.0850   Min.   : 56.0  </span></span>
<span><span class="co">#&gt;  1st Qu.:23.00   1st Qu.:27.57   1st Qu.:0.2535   1st Qu.:100.0  </span></span>
<span><span class="co">#&gt;  Median :28.00   Median :32.80   Median :0.3725   Median :120.5  </span></span>
<span><span class="co">#&gt;  Mean   :32.11   Mean   :32.31   Mean   :0.4608   Mean   :124.0  </span></span>
<span><span class="co">#&gt;  3rd Qu.:39.25   3rd Qu.:36.50   3rd Qu.:0.6160   3rd Qu.:144.0  </span></span>
<span><span class="co">#&gt;  Max.   :63.00   Max.   :47.90   Max.   :2.2880   Max.   :199.0  </span></span>
<span><span class="co">#&gt;        bp              skin           npreg      </span></span>
<span><span class="co">#&gt;  Min.   : 38.00   Min.   : 7.00   Min.   : 0.00  </span></span>
<span><span class="co">#&gt;  1st Qu.: 64.00   1st Qu.:20.75   1st Qu.: 1.00  </span></span>
<span><span class="co">#&gt;  Median : 70.00   Median :29.00   Median : 2.00  </span></span>
<span><span class="co">#&gt;  Mean   : 71.26   Mean   :29.21   Mean   : 3.57  </span></span>
<span><span class="co">#&gt;  3rd Qu.: 78.00   3rd Qu.:36.00   3rd Qu.: 6.00  </span></span>
<span><span class="co">#&gt;  Max.   :110.00   Max.   :99.00   Max.   :14.00</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="connect-to-datashield-and-align-records">Connect to DataSHIELD and align records<a class="anchor" aria-label="anchor" href="#connect-to-datashield-and-align-records"></a>
</h2>
<p>We connect to three independent DataSHIELD sessions, each hosting one
vertical partition. Because all three partitions reside on the same Opal
host, this demonstration validates end-to-end protocol correctness and
client-relay orchestration; performance figures are not intended to
represent a geographically distributed multi-institution deployment.</p>
<p>Each server only knows its own patient identifiers; the PSI protocol
finds the common cohort without revealing which IDs are shared.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSI/" class="external-link">DSI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSOpal/" class="external-link">DSOpal</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/isglobal-brge/dsVertClient" class="external-link">dsVertClient</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>opal.verifyssl <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/newDSLoginBuilder.html" class="external-link">newDSLoginBuilder</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"server1"</span>, url <span class="op">=</span> <span class="st">"https://localhost:8443"</span>,</span>
<span>               user <span class="op">=</span> <span class="st">"administrator"</span>, password <span class="op">=</span> <span class="st">"admin123"</span>,</span>
<span>               driver <span class="op">=</span> <span class="st">"OpalDriver"</span>, table <span class="op">=</span> <span class="st">"pima_project.pima_data"</span><span class="op">)</span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"server2"</span>, url <span class="op">=</span> <span class="st">"https://localhost:8444"</span>,</span>
<span>               user <span class="op">=</span> <span class="st">"administrator"</span>, password <span class="op">=</span> <span class="st">"admin123"</span>,</span>
<span>               driver <span class="op">=</span> <span class="st">"OpalDriver"</span>, table <span class="op">=</span> <span class="st">"pima_project.pima_data"</span><span class="op">)</span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"server3"</span>, url <span class="op">=</span> <span class="st">"https://localhost:8445"</span>,</span>
<span>               user <span class="op">=</span> <span class="st">"administrator"</span>, password <span class="op">=</span> <span class="st">"admin123"</span>,</span>
<span>               driver <span class="op">=</span> <span class="st">"OpalDriver"</span>, table <span class="op">=</span> <span class="st">"pima_project.pima_data"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">conns</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span><span class="va">builder</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span>, assign <span class="op">=</span> <span class="cn">TRUE</span>, symbol <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">psi_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.psiAlign.html">ds.psiAlign</a></span><span class="op">(</span></span>
<span>  data_name   <span class="op">=</span> <span class="st">"D"</span>,</span>
<span>  id_col      <span class="op">=</span> <span class="st">"patient_id"</span>,</span>
<span>  newobj      <span class="op">=</span> <span class="st">"D_aligned"</span>,</span>
<span>  datasources <span class="op">=</span> <span class="va">conns</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; $server1</span></span>
<span><span class="co">#&gt; $server1$n_matched</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $server1$n_total</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $server2</span></span>
<span><span class="co">#&gt; $server2$n_matched</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $server2$n_total</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $server3</span></span>
<span><span class="co">#&gt; $server3$n_matched</span></span>
<span><span class="co">#&gt; [1] 200</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $server3$n_total</span></span>
<span><span class="co">#&gt; [1] 200</span></span></code></pre>
<p>All 200 patients were matched across all three servers (100% match
rate). The ECDH-PSI protocol correctly identified the common cohort
despite independent row shuffling per server.</p>
<hr>
</div>
<div class="section level2">
<h2 id="centralized-analysis-ground-truth">Centralized analysis (ground truth)<a class="anchor" aria-label="anchor" href="#centralized-analysis-ground-truth"></a>
</h2>
<p>All analyses in this section use the full pooled dataset with
standard R functions. These results serve as the reference baseline for
comparison with the federated protocol.</p>
<div class="section level3">
<h3 id="pearson-correlation">Pearson correlation<a class="anchor" aria-label="anchor" href="#pearson-correlation"></a>
</h3>
<p>We compute the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7</mn><mo>×</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">7 \times 7</annotation></semantics></math>
correlation matrix across all numeric variables.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">local_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">num_vars</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;           age    bmi     ped    glu      bp   skin   npreg</span></span>
<span><span class="co">#&gt; age    1.0000 0.1319 -0.0714 0.3434  0.3911 0.2519  0.5989</span></span>
<span><span class="co">#&gt; bmi    0.1319 1.0000  0.1906 0.2168  0.2388 0.6590  0.0583</span></span>
<span><span class="co">#&gt; ped   -0.0714 0.1906  1.0000 0.0607 -0.0474 0.0954 -0.1195</span></span>
<span><span class="co">#&gt; glu    0.3434 0.2168  0.0607 1.0000  0.2694 0.2176  0.1705</span></span>
<span><span class="co">#&gt; bp     0.3911 0.2388 -0.0474 0.2694  1.0000 0.2650  0.2521</span></span>
<span><span class="co">#&gt; skin   0.2519 0.6590  0.0954 0.2176  0.2650 1.0000  0.1090</span></span>
<span><span class="co">#&gt; npreg  0.5989 0.0583 -0.1195 0.1705  0.2521 0.1090  1.0000</span></span></code></pre>
<p><img src="validation_files/figure-html/local-cor-heatmap-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
<p>The strongest correlations are between age and npreg, as well as
between bmi and skin.</p>
</div>
<div class="section level3">
<h3 id="pca-spectral-decomposition">PCA (spectral decomposition)<a class="anchor" aria-label="anchor" href="#pca-spectral-decomposition"></a>
</h3>
<p>We perform PCA via eigendecomposition of the correlation matrix.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">local_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">local_cor</span><span class="op">)</span></span>
<span><span class="va">local_eigenvalues</span> <span class="op">&lt;-</span> <span class="va">local_pca</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="va">local_loadings</span>    <span class="op">&lt;-</span> <span class="va">local_pca</span><span class="op">$</span><span class="va">vectors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">local_loadings</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">num_vars</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">local_loadings</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">num_vars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">local_ve</span> <span class="op">&lt;-</span> <span class="va">local_eigenvalues</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">local_eigenvalues</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span></code></pre></div>
<table class="table">
<caption>Centralized PCA: eigenvalues and variance explained</caption>
<thead><tr class="header">
<th align="left">Component</th>
<th align="right">Eigenvalue</th>
<th align="right">Variance</th>
<th align="right">Cumulative</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PC1</td>
<td align="right">2.4093</td>
<td align="right">34.4%</td>
<td align="right">34.4%</td>
</tr>
<tr class="even">
<td align="left">PC2</td>
<td align="right">1.4964</td>
<td align="right">21.4%</td>
<td align="right">55.8%</td>
</tr>
<tr class="odd">
<td align="left">PC3</td>
<td align="right">0.9119</td>
<td align="right">13%</td>
<td align="right">68.8%</td>
</tr>
<tr class="even">
<td align="left">PC4</td>
<td align="right">0.8000</td>
<td align="right">11.4%</td>
<td align="right">80.3%</td>
</tr>
<tr class="odd">
<td align="left">PC5</td>
<td align="right">0.6901</td>
<td align="right">9.9%</td>
<td align="right">90.1%</td>
</tr>
<tr class="even">
<td align="left">PC6</td>
<td align="right">0.3898</td>
<td align="right">5.6%</td>
<td align="right">95.7%</td>
</tr>
<tr class="odd">
<td align="left">PC7</td>
<td align="right">0.3025</td>
<td align="right">4.3%</td>
<td align="right">100%</td>
</tr>
</tbody>
</table>
<p><img src="validation_files/figure-html/local-scree-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
<p>The first two components explain 55.8% of total variance.</p>
<p><img src="validation_files/figure-html/local-loadings-plot-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="glm-gaussian-y-glu">GLM — Gaussian (y = <code>glu</code>)<a class="anchor" aria-label="anchor" href="#glm-gaussian-y-glu"></a>
</h3>
<p>We fit a Gaussian GLM with glucose concentration as the response
variable and all remaining numeric variables (plus diabetes status) as
predictors.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">local_gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">glu</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">ped</span> <span class="op">+</span> <span class="va">bp</span> <span class="op">+</span> <span class="va">skin</span> <span class="op">+</span> <span class="va">npreg</span> <span class="op">+</span> <span class="va">diabetes</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">df</span>, family <span class="op">=</span> <span class="va">gaussian</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = glu ~ age + bmi + ped + bp + skin + npreg + diabetes, </span></span>
<span><span class="co">#&gt;     family = gaussian, data = df)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept) 68.96159   15.62700   4.413 1.70e-05 ***</span></span>
<span><span class="co">#&gt; age          0.55832    0.24166   2.310   0.0219 *  </span></span>
<span><span class="co">#&gt; bmi          0.23301    0.43405   0.537   0.5920    </span></span>
<span><span class="co">#&gt; ped         -2.36903    6.64389  -0.357   0.7218    </span></span>
<span><span class="co">#&gt; bp           0.31786    0.18792   1.691   0.0924 .  </span></span>
<span><span class="co">#&gt; skin         0.07046    0.22559   0.312   0.7551    </span></span>
<span><span class="co">#&gt; npreg       -0.84245    0.72494  -1.162   0.2466    </span></span>
<span><span class="co">#&gt; diabetes    26.29928    4.64856   5.658 5.51e-08 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for gaussian family taken to be 742.8742)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 199560  on 199  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 142632  on 192  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 1899.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 2</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="glm-binomial-y-diabetes">GLM — Binomial (y = <code>diabetes</code>)<a class="anchor" aria-label="anchor" href="#glm-binomial-y-diabetes"></a>
</h3>
<p>We fit a logistic regression to predict diabetes status from all
seven clinical variables.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">local_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">diabetes</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">ped</span> <span class="op">+</span> <span class="va">glu</span> <span class="op">+</span> <span class="va">bp</span> <span class="op">+</span> <span class="va">skin</span> <span class="op">+</span> <span class="va">npreg</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">df</span>, family <span class="op">=</span> <span class="va">binomial</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = diabetes ~ age + bmi + ped + glu + bp + skin + </span></span>
<span><span class="co">#&gt;     npreg, family = binomial, data = df)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) -9.773062   1.770386  -5.520 3.38e-08 ***</span></span>
<span><span class="co">#&gt; age          0.041184   0.022091   1.864  0.06228 .  </span></span>
<span><span class="co">#&gt; bmi          0.083624   0.042827   1.953  0.05087 .  </span></span>
<span><span class="co">#&gt; ped          1.820410   0.665514   2.735  0.00623 ** </span></span>
<span><span class="co">#&gt; glu          0.032117   0.006787   4.732 2.22e-06 ***</span></span>
<span><span class="co">#&gt; bp          -0.004768   0.018541  -0.257  0.79707    </span></span>
<span><span class="co">#&gt; skin        -0.001917   0.022500  -0.085  0.93211    </span></span>
<span><span class="co">#&gt; npreg        0.103183   0.064694   1.595  0.11073    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for binomial family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 256.41  on 199  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 178.39  on 192  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 194.39</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 5</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="glm-poisson-y-npreg">GLM — Poisson (y = <code>npreg</code>)<a class="anchor" aria-label="anchor" href="#glm-poisson-y-npreg"></a>
</h3>
<p>We model the number of pregnancies as a count variable using a
Poisson GLM with a log link.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">local_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">npreg</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">ped</span> <span class="op">+</span> <span class="va">glu</span> <span class="op">+</span> <span class="va">bp</span> <span class="op">+</span> <span class="va">skin</span> <span class="op">+</span> <span class="va">diabetes</span>,</span>
<span>                  data <span class="op">=</span> <span class="va">df</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; glm(formula = npreg ~ age + bmi + ped + glu + bp + skin + diabetes, </span></span>
<span><span class="co">#&gt;     family = poisson, data = df)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;              Estimate Std. Error z value Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept) -0.026629   0.332370  -0.080  0.93614    </span></span>
<span><span class="co">#&gt; age          0.039114   0.003444  11.358  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; bmi          0.002999   0.008596   0.349  0.72719    </span></span>
<span><span class="co">#&gt; ped         -0.378371   0.148213  -2.553  0.01068 *  </span></span>
<span><span class="co">#&gt; glu         -0.002727   0.001372  -1.988  0.04677 *  </span></span>
<span><span class="co">#&gt; bp           0.004165   0.003720   1.120  0.26284    </span></span>
<span><span class="co">#&gt; skin        -0.002472   0.003820  -0.647  0.51759    </span></span>
<span><span class="co">#&gt; diabetes     0.286849   0.091332   3.141  0.00169 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for poisson family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 627.1  on 199  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 416.1  on 192  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC: 950.12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 5</span></span></code></pre>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="federated-vertical-analysis-dsvert">Federated vertical analysis (dsVert)<a class="anchor" aria-label="anchor" href="#federated-vertical-analysis-dsvert"></a>
</h2>
<p>We now repeat every analysis using the dsVert federated protocol.
Each server only has access to its own subset of variables. Cross-server
quantities (such as correlation matrix off-diagonal blocks, and
gradients involving variables from multiple servers) are computed under
multiparty homomorphic encryption (MHE-CKKS) with threshold decryption,
so individual-level data never leaves any server.</p>
<div class="section level3">
<h3 id="correlation-mhe-ckks">Correlation (MHE-CKKS)<a class="anchor" aria-label="anchor" href="#correlation-mhe-ckks"></a>
</h3>
<p>The <code>ds.vertCor</code> function computes the full
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>7</mn><mo>×</mo><mn>7</mn></mrow><annotation encoding="application/x-tex">7 \times 7</annotation></semantics></math>
Pearson correlation matrix. Within-server blocks are computed locally;
cross-server blocks use CKKS encrypted dot products with threshold
decryption and server-side fusion.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  server1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span>, <span class="st">"ped"</span><span class="op">)</span>,</span>
<span>  server2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glu"</span>, <span class="st">"bp"</span>, <span class="st">"skin"</span><span class="op">)</span>,</span>
<span>  server3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"npreg"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cor_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertCor.html">ds.vertCor</a></span><span class="op">(</span></span>
<span>  data_name   <span class="op">=</span> <span class="st">"D_aligned"</span>,</span>
<span>  variables   <span class="op">=</span> <span class="va">variables</span>,</span>
<span>  log_n       <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  log_scale   <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  datasources <span class="op">=</span> <span class="va">conns</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">dsvert_cor</span> <span class="op">&lt;-</span> <span class="va">cor_result</span><span class="op">$</span><span class="va">correlation</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;           age    bmi     ped    glu      bp   skin   npreg</span></span>
<span><span class="co">#&gt; age    1.0000 0.1319 -0.0714 0.3434  0.3911 0.2519  0.5989</span></span>
<span><span class="co">#&gt; bmi    0.1319 1.0000  0.1906 0.2168  0.2388 0.6590  0.0583</span></span>
<span><span class="co">#&gt; ped   -0.0714 0.1906  1.0000 0.0607 -0.0474 0.0954 -0.1195</span></span>
<span><span class="co">#&gt; glu    0.3434 0.2168  0.0607 1.0000  0.2694 0.2176  0.1705</span></span>
<span><span class="co">#&gt; bp     0.3911 0.2388 -0.0474 0.2694  1.0000 0.2650  0.2521</span></span>
<span><span class="co">#&gt; skin   0.2519 0.6590  0.0954 0.2176  0.2650 1.0000  0.1091</span></span>
<span><span class="co">#&gt; npreg  0.5989 0.0583 -0.1195 0.1705  0.2521 0.1091  1.0000</span></span></code></pre>
<p><img src="validation_files/figure-html/dsvert-cor-heatmap-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="pca">PCA<a class="anchor" aria-label="anchor" href="#pca"></a>
</h3>
<p>PCA is computed by eigendecomposition of the federated correlation
matrix.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dsvert_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">dsvert_cor</span><span class="op">)</span></span>
<span><span class="va">dsvert_eigenvalues</span> <span class="op">&lt;-</span> <span class="va">dsvert_pca</span><span class="op">$</span><span class="va">values</span></span>
<span><span class="va">dsvert_loadings</span>    <span class="op">&lt;-</span> <span class="va">dsvert_pca</span><span class="op">$</span><span class="va">vectors</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">dsvert_loadings</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">num_vars</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">dsvert_loadings</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">num_vars</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">dsvert_ve</span> <span class="op">&lt;-</span> <span class="va">dsvert_eigenvalues</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">dsvert_eigenvalues</span><span class="op">)</span> <span class="op">*</span> <span class="fl">100</span></span></code></pre></div>
<table class="table">
<caption>dsVert PCA: eigenvalues and variance explained</caption>
<thead><tr class="header">
<th align="left">Component</th>
<th align="right">Eigenvalue</th>
<th align="right">Variance</th>
<th align="right">Cumulative</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PC1</td>
<td align="right">2.4093</td>
<td align="right">34.4%</td>
<td align="right">34.4%</td>
</tr>
<tr class="even">
<td align="left">PC2</td>
<td align="right">1.4964</td>
<td align="right">21.4%</td>
<td align="right">55.8%</td>
</tr>
<tr class="odd">
<td align="left">PC3</td>
<td align="right">0.9119</td>
<td align="right">13%</td>
<td align="right">68.8%</td>
</tr>
<tr class="even">
<td align="left">PC4</td>
<td align="right">0.8000</td>
<td align="right">11.4%</td>
<td align="right">80.3%</td>
</tr>
<tr class="odd">
<td align="left">PC5</td>
<td align="right">0.6901</td>
<td align="right">9.9%</td>
<td align="right">90.1%</td>
</tr>
<tr class="even">
<td align="left">PC6</td>
<td align="right">0.3898</td>
<td align="right">5.6%</td>
<td align="right">95.7%</td>
</tr>
<tr class="odd">
<td align="left">PC7</td>
<td align="right">0.3025</td>
<td align="right">4.3%</td>
<td align="right">100%</td>
</tr>
</tbody>
</table>
<p><img src="validation_files/figure-html/dsvert-scree-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
<p><img src="validation_files/figure-html/dsvert-loadings-plot-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="glm-gaussian-y-glu-1">GLM — Gaussian (y = <code>glu</code>)<a class="anchor" aria-label="anchor" href="#glm-gaussian-y-glu-1"></a>
</h3>
<p>The dsVert GLM uses encrypted-label block coordinate descent
(BCD-IRLS). The label variable (<code>glu</code>) resides on server2;
the remaining predictors are distributed across all three servers.
Gradients are computed under MHE-CKKS and decrypted via share-wrapped
threshold decryption with server-side fusion.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_gauss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertGLM.html">ds.vertGLM</a></span><span class="op">(</span></span>
<span>  data_name <span class="op">=</span> <span class="st">"D_aligned"</span>, y_var <span class="op">=</span> <span class="st">"glu"</span>,</span>
<span>  x_vars    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>server1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span>, <span class="st">"ped"</span><span class="op">)</span>,</span>
<span>                   server2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bp"</span>, <span class="st">"skin"</span><span class="op">)</span>,</span>
<span>                   server3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"npreg"</span>, <span class="st">"diabetes"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  y_server  <span class="op">=</span> <span class="st">"server2"</span>, family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">100</span>, tol <span class="op">=</span> <span class="fl">1e-4</span>, lambda <span class="op">=</span> <span class="fl">1e-4</span>,</span>
<span>  log_n <span class="op">=</span> <span class="fl">12</span>, log_scale <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  datasources <span class="op">=</span> <span class="va">conns</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;               Length Class  Mode     </span></span>
<span><span class="co">#&gt; coefficients   8     -none- numeric  </span></span>
<span><span class="co">#&gt; iterations     1     -none- numeric  </span></span>
<span><span class="co">#&gt; converged      1     -none- logical  </span></span>
<span><span class="co">#&gt; family         1     -none- character</span></span>
<span><span class="co">#&gt; n_obs          1     -none- numeric  </span></span>
<span><span class="co">#&gt; n_vars         1     -none- numeric  </span></span>
<span><span class="co">#&gt; lambda         1     -none- numeric  </span></span>
<span><span class="co">#&gt; deviance       1     -none- numeric  </span></span>
<span><span class="co">#&gt; null_deviance  1     -none- numeric  </span></span>
<span><span class="co">#&gt; pseudo_r2      1     -none- numeric  </span></span>
<span><span class="co">#&gt; aic            1     -none- numeric  </span></span>
<span><span class="co">#&gt; y_server       1     -none- character</span></span>
<span><span class="co">#&gt; call          12     -none- call</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="glm-binomial-y-diabetes-1">GLM — Binomial (y = <code>diabetes</code>)<a class="anchor" aria-label="anchor" href="#glm-binomial-y-diabetes-1"></a>
</h3>
<p>Logistic regression with the binary outcome on server3. The IRLS
working weights are computed on the label server and routed to non-label
servers via transport encryption.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertGLM.html">ds.vertGLM</a></span><span class="op">(</span></span>
<span>  data_name <span class="op">=</span> <span class="st">"D_aligned"</span>, y_var <span class="op">=</span> <span class="st">"diabetes"</span>,</span>
<span>  x_vars    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>server1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span>, <span class="st">"ped"</span><span class="op">)</span>,</span>
<span>                   server2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glu"</span>, <span class="st">"bp"</span>, <span class="st">"skin"</span><span class="op">)</span>,</span>
<span>                   server3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"npreg"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  y_server  <span class="op">=</span> <span class="st">"server3"</span>, family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">100</span>, tol <span class="op">=</span> <span class="fl">1e-4</span>, lambda <span class="op">=</span> <span class="fl">1e-4</span>,</span>
<span>  log_n <span class="op">=</span> <span class="fl">12</span>, log_scale <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  datasources <span class="op">=</span> <span class="va">conns</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;               Length Class  Mode     </span></span>
<span><span class="co">#&gt; coefficients   8     -none- numeric  </span></span>
<span><span class="co">#&gt; iterations     1     -none- numeric  </span></span>
<span><span class="co">#&gt; converged      1     -none- logical  </span></span>
<span><span class="co">#&gt; family         1     -none- character</span></span>
<span><span class="co">#&gt; n_obs          1     -none- numeric  </span></span>
<span><span class="co">#&gt; n_vars         1     -none- numeric  </span></span>
<span><span class="co">#&gt; lambda         1     -none- numeric  </span></span>
<span><span class="co">#&gt; deviance       1     -none- numeric  </span></span>
<span><span class="co">#&gt; null_deviance  1     -none- numeric  </span></span>
<span><span class="co">#&gt; pseudo_r2      1     -none- numeric  </span></span>
<span><span class="co">#&gt; aic            1     -none- numeric  </span></span>
<span><span class="co">#&gt; y_server       1     -none- character</span></span>
<span><span class="co">#&gt; call          12     -none- call</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="glm-poisson-y-npreg-1">GLM — Poisson (y = <code>npreg</code>)<a class="anchor" aria-label="anchor" href="#glm-poisson-y-npreg-1"></a>
</h3>
<p>Count regression for the number of pregnancies. The Poisson log-link
compresses the coefficient scale, which tends to aid convergence of the
encrypted BCD procedure.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">glm_pois</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertGLM.html">ds.vertGLM</a></span><span class="op">(</span></span>
<span>  data_name <span class="op">=</span> <span class="st">"D_aligned"</span>, y_var <span class="op">=</span> <span class="st">"npreg"</span>,</span>
<span>  x_vars    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>server1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span>, <span class="st">"ped"</span><span class="op">)</span>,</span>
<span>                   server2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glu"</span>, <span class="st">"bp"</span>, <span class="st">"skin"</span><span class="op">)</span>,</span>
<span>                   server3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diabetes"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  y_server  <span class="op">=</span> <span class="st">"server3"</span>, family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">100</span>, tol <span class="op">=</span> <span class="fl">1e-4</span>, lambda <span class="op">=</span> <span class="fl">1e-4</span>,</span>
<span>  log_n <span class="op">=</span> <span class="fl">12</span>, log_scale <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  datasources <span class="op">=</span> <span class="va">conns</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;               Length Class  Mode     </span></span>
<span><span class="co">#&gt; coefficients   8     -none- numeric  </span></span>
<span><span class="co">#&gt; iterations     1     -none- numeric  </span></span>
<span><span class="co">#&gt; converged      1     -none- logical  </span></span>
<span><span class="co">#&gt; family         1     -none- character</span></span>
<span><span class="co">#&gt; n_obs          1     -none- numeric  </span></span>
<span><span class="co">#&gt; n_vars         1     -none- numeric  </span></span>
<span><span class="co">#&gt; lambda         1     -none- numeric  </span></span>
<span><span class="co">#&gt; deviance       1     -none- numeric  </span></span>
<span><span class="co">#&gt; null_deviance  1     -none- numeric  </span></span>
<span><span class="co">#&gt; pseudo_r2      1     -none- numeric  </span></span>
<span><span class="co">#&gt; aic            1     -none- numeric  </span></span>
<span><span class="co">#&gt; y_server       1     -none- character</span></span>
<span><span class="co">#&gt; call          12     -none- call</span></span></code></pre>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="comparative-assessment">Comparative assessment<a class="anchor" aria-label="anchor" href="#comparative-assessment"></a>
</h2>
<p>We now compare the centralized and federated results
quantitatively.</p>
<div class="section level3">
<h3 id="correlation-element-wise-differences">Correlation: element-wise differences<a class="anchor" aria-label="anchor" href="#correlation-element-wise-differences"></a>
</h3>
<p>We compute the element-wise difference matrix between the dsVert and
centralized correlation matrices.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cor_diff</span> <span class="op">&lt;-</span> <span class="va">dsvert_cor</span> <span class="op">-</span> <span class="va">local_cor</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;            age      bmi      ped      glu       bp     skin    npreg</span></span>
<span><span class="co">#&gt; age    0.0e+00  0.0e+00  0.0e+00 -3.1e-06 -5.3e-06  2.9e-06  4.5e-06</span></span>
<span><span class="co">#&gt; bmi    0.0e+00  0.0e+00  0.0e+00  5.5e-06 -7.4e-06  2.0e-07  4.5e-06</span></span>
<span><span class="co">#&gt; ped    0.0e+00  0.0e+00  0.0e+00  5.0e-07 -2.7e-06 -2.3e-06 -2.1e-06</span></span>
<span><span class="co">#&gt; glu   -3.1e-06  5.5e-06  5.0e-07  0.0e+00  0.0e+00  0.0e+00 -1.4e-06</span></span>
<span><span class="co">#&gt; bp    -5.3e-06 -7.4e-06 -2.7e-06  0.0e+00  0.0e+00  0.0e+00  4.0e-06</span></span>
<span><span class="co">#&gt; skin   2.9e-06  2.0e-07 -2.3e-06  0.0e+00  0.0e+00  0.0e+00  2.3e-06</span></span>
<span><span class="co">#&gt; npreg  4.5e-06  4.5e-06 -2.1e-06 -1.4e-06  4.0e-06  2.3e-06  0.0e+00</span></span></code></pre>
<p><img src="validation_files/figure-html/cmp-cor-heatmap-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
<p>All element-wise differences are of order
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mrow><mi>−</mi><mn>6</mn></mrow></msup><annotation encoding="application/x-tex">10^{-6}</annotation></semantics></math>,
well below any substantively meaningful threshold.</p>
</div>
<div class="section level3">
<h3 id="pca-eigenvalue-comparison">PCA: eigenvalue comparison<a class="anchor" aria-label="anchor" href="#pca-eigenvalue-comparison"></a>
</h3>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">eig_diff</span> <span class="op">&lt;-</span> <span class="va">dsvert_eigenvalues</span> <span class="op">-</span> <span class="va">local_eigenvalues</span></span></code></pre></div>
<table class="table">
<caption>Eigenvalue comparison (centralized vs. dsVert)</caption>
<thead><tr class="header">
<th align="left">Component</th>
<th align="right">Local</th>
<th align="right">dsVert</th>
<th align="right">Difference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PC1</td>
<td align="right">2.409261</td>
<td align="right">2.409263</td>
<td align="right">1.57e-06</td>
</tr>
<tr class="even">
<td align="left">PC2</td>
<td align="right">1.496447</td>
<td align="right">1.496446</td>
<td align="right">-1.39e-06</td>
</tr>
<tr class="odd">
<td align="left">PC3</td>
<td align="right">0.911868</td>
<td align="right">0.911867</td>
<td align="right">-6.30e-07</td>
</tr>
<tr class="even">
<td align="left">PC4</td>
<td align="right">0.799971</td>
<td align="right">0.799973</td>
<td align="right">2.18e-06</td>
</tr>
<tr class="odd">
<td align="left">PC5</td>
<td align="right">0.690135</td>
<td align="right">0.690136</td>
<td align="right">5.35e-07</td>
</tr>
<tr class="even">
<td align="left">PC6</td>
<td align="right">0.389819</td>
<td align="right">0.389820</td>
<td align="right">9.14e-07</td>
</tr>
<tr class="odd">
<td align="left">PC7</td>
<td align="right">0.302499</td>
<td align="right">0.302496</td>
<td align="right">-3.18e-06</td>
</tr>
</tbody>
</table>
<p><img src="validation_files/figure-html/cmp-pca-plot-1.png" class="r-plt" width="672" style="display: block; margin: auto;"></p>
<p>The eigenvalues are virtually identical; differences are of order
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mrow><mi>−</mi><mn>6</mn></mrow></msup><annotation encoding="application/x-tex">10^{-6}</annotation></semantics></math>,
propagated directly from the correlation matrix precision.</p>
</div>
<div class="section level3">
<h3 id="glm-gaussian-coefficient-comparison-y-glu">GLM: Gaussian coefficient comparison (y = <code>glu</code>)<a class="anchor" aria-label="anchor" href="#glm-gaussian-coefficient-comparison-y-glu"></a>
</h3>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gauss_local</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">local_gauss</span><span class="op">)</span></span>
<span><span class="va">gauss_dsvert</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">glm_gauss</span><span class="op">)</span></span>
<span><span class="va">gauss_diff</span>   <span class="op">&lt;-</span> <span class="va">gauss_dsvert</span> <span class="op">-</span> <span class="va">gauss_local</span></span></code></pre></div>
<table class="table">
<caption>Gaussian GLM coefficient comparison (y = glu)</caption>
<thead><tr class="header">
<th align="left">Term</th>
<th align="right">Local</th>
<th align="right">dsVert</th>
<th align="right">Difference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">68.9616</td>
<td align="right">68.9678</td>
<td align="right">6.23e-03</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.5583</td>
<td align="right">0.5580</td>
<td align="right">-2.98e-04</td>
</tr>
<tr class="odd">
<td align="left">bmi</td>
<td align="right">0.2330</td>
<td align="right">0.2328</td>
<td align="right">-2.23e-04</td>
</tr>
<tr class="even">
<td align="left">ped</td>
<td align="right">-2.3690</td>
<td align="right">-2.3694</td>
<td align="right">-3.41e-04</td>
</tr>
<tr class="odd">
<td align="left">bp</td>
<td align="right">0.3179</td>
<td align="right">0.3179</td>
<td align="right">5.41e-05</td>
</tr>
<tr class="even">
<td align="left">skin</td>
<td align="right">0.0705</td>
<td align="right">0.0706</td>
<td align="right">1.37e-04</td>
</tr>
<tr class="odd">
<td align="left">npreg</td>
<td align="right">-0.8424</td>
<td align="right">-0.8418</td>
<td align="right">6.50e-04</td>
</tr>
<tr class="even">
<td align="left">diabetes</td>
<td align="right">26.2993</td>
<td align="right">26.3008</td>
<td align="right">1.52e-03</td>
</tr>
</tbody>
</table>
<p><img src="validation_files/figure-html/cmp-gauss-plot-1.png" class="r-plt" width="768" style="display: block; margin: auto;"></p>
<p>Maximum absolute coefficient difference: 6.23e-03.</p>
</div>
<div class="section level3">
<h3 id="glm-binomial-coefficient-comparison-y-diabetes">GLM: Binomial coefficient comparison (y =
<code>diabetes</code>)<a class="anchor" aria-label="anchor" href="#glm-binomial-coefficient-comparison-y-diabetes"></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">binom_local</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">local_binom</span><span class="op">)</span></span>
<span><span class="va">binom_dsvert</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">glm_binom</span><span class="op">)</span></span>
<span><span class="va">binom_diff</span>   <span class="op">&lt;-</span> <span class="va">binom_dsvert</span> <span class="op">-</span> <span class="va">binom_local</span></span></code></pre></div>
<table class="table">
<caption>Binomial GLM coefficient comparison (y = diabetes)</caption>
<thead><tr class="header">
<th align="left">Term</th>
<th align="right">Local</th>
<th align="right">dsVert</th>
<th align="right">Difference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-9.7731</td>
<td align="right">-9.7727</td>
<td align="right">3.91e-04</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.0412</td>
<td align="right">0.0412</td>
<td align="right">-5.24e-06</td>
</tr>
<tr class="odd">
<td align="left">bmi</td>
<td align="right">0.0836</td>
<td align="right">0.0836</td>
<td align="right">-1.02e-05</td>
</tr>
<tr class="even">
<td align="left">ped</td>
<td align="right">1.8204</td>
<td align="right">1.8203</td>
<td align="right">-6.39e-05</td>
</tr>
<tr class="odd">
<td align="left">glu</td>
<td align="right">0.0321</td>
<td align="right">0.0321</td>
<td align="right">-5.49e-07</td>
</tr>
<tr class="even">
<td align="left">bp</td>
<td align="right">-0.0048</td>
<td align="right">-0.0048</td>
<td align="right">1.13e-06</td>
</tr>
<tr class="odd">
<td align="left">skin</td>
<td align="right">-0.0019</td>
<td align="right">-0.0019</td>
<td align="right">4.52e-06</td>
</tr>
<tr class="even">
<td align="left">npreg</td>
<td align="right">0.1032</td>
<td align="right">0.1032</td>
<td align="right">5.39e-06</td>
</tr>
</tbody>
</table>
<p><img src="validation_files/figure-html/cmp-binom-plot-1.png" class="r-plt" width="768" style="display: block; margin: auto;"></p>
<p>Maximum absolute coefficient difference: 3.91e-04.</p>
</div>
<div class="section level3">
<h3 id="glm-poisson-coefficient-comparison-y-npreg">GLM: Poisson coefficient comparison (y = <code>npreg</code>)<a class="anchor" aria-label="anchor" href="#glm-poisson-coefficient-comparison-y-npreg"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pois_local</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">local_pois</span><span class="op">)</span></span>
<span><span class="va">pois_dsvert</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">glm_pois</span><span class="op">)</span></span>
<span><span class="va">pois_diff</span>   <span class="op">&lt;-</span> <span class="va">pois_dsvert</span> <span class="op">-</span> <span class="va">pois_local</span></span></code></pre></div>
<table class="table">
<caption>Poisson GLM coefficient comparison (y = npreg)</caption>
<thead><tr class="header">
<th align="left">Term</th>
<th align="right">Local</th>
<th align="right">dsVert</th>
<th align="right">Difference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(Intercept)</td>
<td align="right">-0.0266</td>
<td align="right">-0.0264</td>
<td align="right">1.84e-04</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0.0391</td>
<td align="right">0.0391</td>
<td align="right">-6.38e-06</td>
</tr>
<tr class="odd">
<td align="left">bmi</td>
<td align="right">0.0030</td>
<td align="right">0.0030</td>
<td align="right">-1.90e-05</td>
</tr>
<tr class="even">
<td align="left">ped</td>
<td align="right">-0.3784</td>
<td align="right">-0.3784</td>
<td align="right">-1.64e-05</td>
</tr>
<tr class="odd">
<td align="left">glu</td>
<td align="right">-0.0027</td>
<td align="right">-0.0027</td>
<td align="right">7.02e-07</td>
</tr>
<tr class="even">
<td align="left">bp</td>
<td align="right">0.0042</td>
<td align="right">0.0042</td>
<td align="right">4.97e-06</td>
</tr>
<tr class="odd">
<td align="left">skin</td>
<td align="right">-0.0025</td>
<td align="right">-0.0025</td>
<td align="right">7.23e-06</td>
</tr>
<tr class="even">
<td align="left">diabetes</td>
<td align="right">0.2868</td>
<td align="right">0.2869</td>
<td align="right">4.15e-05</td>
</tr>
</tbody>
</table>
<p><img src="validation_files/figure-html/cmp-pois-plot-1.png" class="r-plt" width="768" style="display: block; margin: auto;"></p>
<p>Maximum absolute coefficient difference: 1.84e-04.</p>
</div>
<div class="section level3">
<h3 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h3>
<table class="table">
<caption>Validation summary (dsVert vs. centralized R)</caption>
<thead><tr class="header">
<th align="left">Protocol</th>
<th align="left">Metric</th>
<th align="right">Value</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">PSI Alignment</td>
<td align="left">Matched cohort</td>
<td align="right">200 / 200 (100%)</td>
</tr>
<tr class="even">
<td align="left">Correlation</td>
<td align="left">Max |r| error</td>
<td align="right">7.38e-06</td>
</tr>
<tr class="odd">
<td align="left">PCA</td>
<td align="left">Max eigenvalue error</td>
<td align="right">3.18e-06</td>
</tr>
<tr class="even">
<td align="left">GLM Gaussian</td>
<td align="left">Max |coef| error</td>
<td align="right">6.23e-03</td>
</tr>
<tr class="odd">
<td align="left">GLM Binomial</td>
<td align="left">Max |coef| error</td>
<td align="right">3.91e-04</td>
</tr>
<tr class="even">
<td align="left">GLM Poisson</td>
<td align="left">Max |coef| error</td>
<td align="right">1.84e-04</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="error-analysis">Error analysis<a class="anchor" aria-label="anchor" href="#error-analysis"></a>
</h3>
<p>The three error regimes observed correspond to different sources of
approximation in the dsVert pipeline:</p>
<p><strong>Correlation and PCA</strong>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo><msup><mn>10</mn><mrow><mi>−</mi><mn>6</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\sim 10^{-6}</annotation></semantics></math>).
These errors arise from CKKS approximate arithmetic used in the MHE
threshold protocol. The encoding precision is governed by
<code>log_scale = 40</code>, providing approximately
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mn>40</mn></msup><mo>≈</mo><msup><mn>10</mn><mn>12</mn></msup></mrow><annotation encoding="application/x-tex">2^{40}
\approx 10^{12}</annotation></semantics></math> precision units. After
encoding, homomorphic multiplication, inner-sum rotations, and threshold
decryption, the effective precision degrades to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∼</mo><msup><mn>10</mn><mrow><mi>−</mi><mn>6</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\sim 10^{-6}</annotation></semantics></math>,
consistent with CKKS error propagation theory.</p>
<p><strong>GLM coefficients</strong>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mrow><mi>−</mi><mn>4</mn></mrow></msup><annotation encoding="application/x-tex">10^{-4}</annotation></semantics></math>
to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mn>10</mn><mrow><mi>−</mi><mn>3</mn></mrow></msup><annotation encoding="application/x-tex">10^{-3}</annotation></semantics></math>).
GLM errors are slightly larger because they accumulate over multiple
BCD-IRLS iterations, each involving an encrypted gradient computation.
Additionally, the ridge regularization parameter
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>=</mo><msup><mn>10</mn><mrow><mi>−</mi><mn>4</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\lambda = 10^{-4}</annotation></semantics></math>)
introduces a small systematic bias relative to the unpenalized
centralized <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>. The binomial and Poisson families show
smaller errors than Gaussian because their link functions (logit, log)
compress the coefficient scale.</p>
<p>In all cases, the errors are far below any practically meaningful
threshold for statistical inference.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

<div class="pkgdown-footer-right">

</div>

    </footer>
</div>





  </body>
</html>
