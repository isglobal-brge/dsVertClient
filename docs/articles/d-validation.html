<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Validation â€¢ dsVertClient</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Validation">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsVertClient</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/a-getting-started.html">Getting Started with dsVertClient</a></li>
    <li><a class="dropdown-item" href="../articles/b-statistical-analysis.html">Statistical Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/c-methodology.html">Methodology</a></li>
    <li><a class="dropdown-item" href="../articles/d-validation.html">Validation</a></li>
    <li><a class="dropdown-item" href="../articles/e-security.html">Security Model</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/isglobal-brge/dsVertClient" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Validation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/isglobal-brge/dsVertClient/blob/HEAD/vignettes/d-validation.Rmd" class="external-link"><code>vignettes/d-validation.Rmd</code></a></small>
      <div class="d-none name"><code>d-validation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette validates the distributed analysis pipeline implemented
in dsVertClient by comparing it against a standard local analysis where
all data is pooled in one place. If the distributed protocol is correct,
both scenarios should produce nearly identical results, differing only
by the small approximation error inherent to CKKS homomorphic encryption
and the L2 regularisation used in distributed GLM.</p>
<table class="table">
<colgroup>
<col width="18%">
<col width="81%">
</colgroup>
<thead><tr class="header">
<th>Scenario</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Local</td>
<td>All data pooled on one machine, standard R functions</td>
</tr>
<tr class="even">
<td>Distributed</td>
<td>Data split across 3 Opal servers, dsVertClient functions</td>
</tr>
</tbody>
</table>
<p>The data is split across three servers as follows:</p>
<table class="table">
<thead><tr class="header">
<th>Server</th>
<th>Variables</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>server1</td>
<td>patient_id, age, bmi</td>
</tr>
<tr class="even">
<td>server2</td>
<td>patient_id, glucose, bp, hypertension, visits</td>
</tr>
<tr class="odd">
<td>server3</td>
<td>patient_id, cholesterol, heart_rate</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="scenario-1-local-analysis">Scenario 1: Local Analysis<a class="anchor" aria-label="anchor" href="#scenario-1-local-analysis"></a>
</h2>
<p>In this scenario we download the raw data from all three servers,
merge by <code>patient_id</code>, and run standard R functions. This
serves as the ground truth against which the distributed results are
compared.</p>
<div class="section level3">
<h3 id="data">Data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/obiba/opalr/" class="external-link">opalr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">o1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.obiba.org/opalr/reference/opal.login.html" class="external-link">opal.login</a></span><span class="op">(</span><span class="st">"administrator"</span>, <span class="st">"admin123"</span>, url <span class="op">=</span> <span class="st">"https://opal1.example.org"</span><span class="op">)</span></span>
<span><span class="va">d1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.obiba.org/opalr/reference/opal.table_get.html" class="external-link">opal.table_get</a></span><span class="op">(</span><span class="va">o1</span>, <span class="st">"project"</span>, <span class="st">"server1_data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://www.obiba.org/opalr/reference/opal.logout.html" class="external-link">opal.logout</a></span><span class="op">(</span><span class="va">o1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">o2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.obiba.org/opalr/reference/opal.login.html" class="external-link">opal.login</a></span><span class="op">(</span><span class="st">"administrator"</span>, <span class="st">"admin123"</span>, url <span class="op">=</span> <span class="st">"https://opal2.example.org"</span><span class="op">)</span></span>
<span><span class="va">d2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.obiba.org/opalr/reference/opal.table_get.html" class="external-link">opal.table_get</a></span><span class="op">(</span><span class="va">o2</span>, <span class="st">"project"</span>, <span class="st">"server2_data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://www.obiba.org/opalr/reference/opal.logout.html" class="external-link">opal.logout</a></span><span class="op">(</span><span class="va">o2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">o3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.obiba.org/opalr/reference/opal.login.html" class="external-link">opal.login</a></span><span class="op">(</span><span class="st">"administrator"</span>, <span class="st">"admin123"</span>, url <span class="op">=</span> <span class="st">"https://opal3.example.org"</span><span class="op">)</span></span>
<span><span class="va">d3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://www.obiba.org/opalr/reference/opal.table_get.html" class="external-link">opal.table_get</a></span><span class="op">(</span><span class="va">o3</span>, <span class="st">"project"</span>, <span class="st">"server3_data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://www.obiba.org/opalr/reference/opal.logout.html" class="external-link">opal.logout</a></span><span class="op">(</span><span class="va">o3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">d1</span>, <span class="va">d2</span>, by <span class="op">=</span> <span class="st">"patient_id"</span><span class="op">)</span>, <span class="va">d3</span>, by <span class="op">=</span> <span class="st">"patient_id"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="local-correlation">Local Correlation<a class="anchor" aria-label="anchor" href="#local-correlation"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span>, <span class="st">"glucose"</span>, <span class="st">"cholesterol"</span>, <span class="st">"heart_rate"</span>, <span class="st">"bp"</span><span class="op">)</span></span>
<span><span class="va">local_cor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">merged</span><span class="op">[</span>, <span class="va">vars</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">local_cor</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="17%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="17%">
<col width="16%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>age</th>
<th>bmi</th>
<th>glucose</th>
<th>cholesterol</th>
<th>heart_rate</th>
<th>bp</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>age</td>
<td>1.0000</td>
<td>-0.3202</td>
<td>-0.0997</td>
<td>0.2215</td>
<td>-0.0878</td>
<td>0.0051</td>
</tr>
<tr class="even">
<td>bmi</td>
<td>-0.3202</td>
<td>1.0000</td>
<td>-0.0855</td>
<td>-0.0159</td>
<td>0.3116</td>
<td>0.2266</td>
</tr>
<tr class="odd">
<td>glucose</td>
<td>-0.0997</td>
<td>-0.0855</td>
<td>1.0000</td>
<td>-0.0025</td>
<td>0.1311</td>
<td>-0.0357</td>
</tr>
<tr class="even">
<td>cholesterol</td>
<td>0.2215</td>
<td>-0.0159</td>
<td>-0.0025</td>
<td>1.0000</td>
<td>-0.2407</td>
<td>-0.0452</td>
</tr>
<tr class="odd">
<td>heart_rate</td>
<td>-0.0878</td>
<td>0.3116</td>
<td>0.1311</td>
<td>-0.2407</td>
<td>1.0000</td>
<td>0.2440</td>
</tr>
<tr class="even">
<td>bp</td>
<td>0.0051</td>
<td>0.2266</td>
<td>-0.0357</td>
<td>-0.0452</td>
<td>0.2440</td>
<td>1.0000</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="local-pca">Local PCA<a class="anchor" aria-label="anchor" href="#local-pca"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span>, <span class="st">"glucose"</span>, <span class="st">"cholesterol"</span>, <span class="st">"heart_rate"</span><span class="op">)</span></span>
<span><span class="va">local_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">merged</span><span class="op">[</span>, <span class="va">pca_vars</span><span class="op">]</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">local_pca</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th>Component</th>
<th>Eigenvalue</th>
<th>Variance (%)</th>
<th>Cumulative (%)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>PC1</td>
<td>1.6153</td>
<td>32.31</td>
<td>32.31</td>
</tr>
<tr class="even">
<td>PC2</td>
<td>1.0710</td>
<td>21.42</td>
<td>53.73</td>
</tr>
<tr class="odd">
<td>PC3</td>
<td>0.9567</td>
<td>19.13</td>
<td>72.86</td>
</tr>
<tr class="even">
<td>PC4</td>
<td>0.9083</td>
<td>18.17</td>
<td>91.03</td>
</tr>
<tr class="odd">
<td>PC5</td>
<td>0.4486</td>
<td>8.97</td>
<td>100.00</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="local-glms">Local GLMs<a class="anchor" aria-label="anchor" href="#local-glms"></a>
</h3>
<p>Three GLMs are fitted locally on the merged data, one for each
supported family. The same five predictors are used in all models.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_gaussian</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">bp</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">glucose</span> <span class="op">+</span> <span class="va">cholesterol</span> <span class="op">+</span> <span class="va">heart_rate</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">merged</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">gaussian</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit_binomial</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">hypertension</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">glucose</span> <span class="op">+</span> <span class="va">cholesterol</span> <span class="op">+</span> <span class="va">heart_rate</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">merged</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit_poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">visits</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">glucose</span> <span class="op">+</span> <span class="va">cholesterol</span> <span class="op">+</span> <span class="va">heart_rate</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">merged</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>Gaussian coefficients:</strong></p>
<table class="table">
<thead><tr class="header">
<th>Coefficient</th>
<th>Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td>76.4455</td>
</tr>
<tr class="even">
<td>age</td>
<td>0.0654</td>
</tr>
<tr class="odd">
<td>bmi</td>
<td>0.5411</td>
</tr>
<tr class="even">
<td>glucose</td>
<td>-0.0270</td>
</tr>
<tr class="odd">
<td>cholesterol</td>
<td>-0.0062</td>
</tr>
<tr class="even">
<td>heart_rate</td>
<td>0.2766</td>
</tr>
</tbody>
</table>
<p><strong>Binomial coefficients:</strong></p>
<table class="table">
<thead><tr class="header">
<th>Coefficient</th>
<th>Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td>-4.8323</td>
</tr>
<tr class="even">
<td>age</td>
<td>0.0240</td>
</tr>
<tr class="odd">
<td>bmi</td>
<td>0.0486</td>
</tr>
<tr class="even">
<td>glucose</td>
<td>0.0056</td>
</tr>
<tr class="odd">
<td>cholesterol</td>
<td>-0.0051</td>
</tr>
<tr class="even">
<td>heart_rate</td>
<td>0.0354</td>
</tr>
</tbody>
</table>
<p><strong>Poisson coefficients:</strong></p>
<table class="table">
<thead><tr class="header">
<th>Coefficient</th>
<th>Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td>1.6309</td>
</tr>
<tr class="even">
<td>age</td>
<td>-0.0054</td>
</tr>
<tr class="odd">
<td>bmi</td>
<td>-0.0063</td>
</tr>
<tr class="even">
<td>glucose</td>
<td>0.0062</td>
</tr>
<tr class="odd">
<td>cholesterol</td>
<td>-0.0015</td>
</tr>
<tr class="even">
<td>heart_rate</td>
<td>0.0068</td>
</tr>
</tbody>
</table>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="scenario-2-distributed-analysis">Scenario 2: Distributed Analysis<a class="anchor" aria-label="anchor" href="#scenario-2-distributed-analysis"></a>
</h2>
<p>In this scenario the data never leaves the three Opal servers. All
computations are performed using dsVertClient functions, which rely on
MHE threshold decryption for correlation and PCA, and Block Coordinate
Descent for GLM.</p>
<div class="section level3">
<h3 id="connect-and-align">Connect and Align<a class="anchor" aria-label="anchor" href="#connect-and-align"></a>
</h3>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/isglobal-brge/dsVertClient" class="external-link">dsVertClient</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSI/" class="external-link">DSI</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/datashield/DSOpal/" class="external-link">DSOpal</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">builder</span> <span class="op">&lt;-</span> <span class="fu">DSI</span><span class="fu">::</span><span class="fu"><a href="https://datashield.github.io/DSI/reference/newDSLoginBuilder.html" class="external-link">newDSLoginBuilder</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"server1"</span>, url <span class="op">=</span> <span class="st">"https://opal1.example.org"</span>,</span>
<span>               table <span class="op">=</span> <span class="st">"project.server1_data"</span>, user <span class="op">=</span> <span class="st">"analyst"</span>,</span>
<span>               password <span class="op">=</span> <span class="st">"password"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"server2"</span>, url <span class="op">=</span> <span class="st">"https://opal2.example.org"</span>,</span>
<span>               table <span class="op">=</span> <span class="st">"project.server2_data"</span>, user <span class="op">=</span> <span class="st">"analyst"</span>,</span>
<span>               password <span class="op">=</span> <span class="st">"password"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span><span class="va">builder</span><span class="op">$</span><span class="fu">append</span><span class="op">(</span>server <span class="op">=</span> <span class="st">"server3"</span>, url <span class="op">=</span> <span class="st">"https://opal3.example.org"</span>,</span>
<span>               table <span class="op">=</span> <span class="st">"project.server3_data"</span>, user <span class="op">=</span> <span class="st">"analyst"</span>,</span>
<span>               password <span class="op">=</span> <span class="st">"password"</span>, driver <span class="op">=</span> <span class="st">"OpalDriver"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">connections</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.login.html" class="external-link">datashield.login</a></span><span class="op">(</span><span class="va">builder</span><span class="op">$</span><span class="fu">build</span><span class="op">(</span><span class="op">)</span>, assign <span class="op">=</span> <span class="cn">TRUE</span>, symbol <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ds.psiAlign.html">ds.psiAlign</a></span><span class="op">(</span><span class="st">"D"</span>, <span class="st">"patient_id"</span>, <span class="st">"D_aligned"</span>, datasources <span class="op">=</span> <span class="va">connections</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="distributed-correlation">Distributed Correlation<a class="anchor" aria-label="anchor" href="#distributed-correlation"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  server1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span><span class="op">)</span>,</span>
<span>  server2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glucose"</span>, <span class="st">"bp"</span><span class="op">)</span>,</span>
<span>  server3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cholesterol"</span>, <span class="st">"heart_rate"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cor_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertCor.html">ds.vertCor</a></span><span class="op">(</span><span class="st">"D_aligned"</span>, <span class="va">x_vars</span>, datasources <span class="op">=</span> <span class="va">connections</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">cor_dist</span><span class="op">$</span><span class="va">correlation</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="17%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="12%">
<col width="17%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th></th>
<th>age</th>
<th>bmi</th>
<th>glucose</th>
<th>bp</th>
<th>cholesterol</th>
<th>heart_rate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>age</td>
<td>1.0000</td>
<td>-0.3202</td>
<td>-0.0997</td>
<td>0.0051</td>
<td>0.2215</td>
<td>-0.0877</td>
</tr>
<tr class="even">
<td>bmi</td>
<td>-0.3202</td>
<td>1.0000</td>
<td>-0.0855</td>
<td>0.2266</td>
<td>-0.0159</td>
<td>0.3117</td>
</tr>
<tr class="odd">
<td>glucose</td>
<td>-0.0997</td>
<td>-0.0855</td>
<td>1.0000</td>
<td>-0.0357</td>
<td>-0.0025</td>
<td>0.1311</td>
</tr>
<tr class="even">
<td>bp</td>
<td>0.0051</td>
<td>0.2266</td>
<td>-0.0357</td>
<td>1.0000</td>
<td>-0.0452</td>
<td>0.2440</td>
</tr>
<tr class="odd">
<td>cholesterol</td>
<td>0.2215</td>
<td>-0.0159</td>
<td>-0.0025</td>
<td>-0.0452</td>
<td>1.0000</td>
<td>-0.2407</td>
</tr>
<tr class="even">
<td>heart_rate</td>
<td>-0.0877</td>
<td>0.3117</td>
<td>0.1311</td>
<td>0.2440</td>
<td>-0.2407</td>
<td>1.0000</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="distributed-pca">Distributed PCA<a class="anchor" aria-label="anchor" href="#distributed-pca"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  server1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span><span class="op">)</span>,</span>
<span>  server2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glucose"</span><span class="op">)</span>,</span>
<span>  server3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cholesterol"</span>, <span class="st">"heart_rate"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">cor_pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertCor.html">ds.vertCor</a></span><span class="op">(</span><span class="st">"D_aligned"</span>, <span class="va">pca_vars</span>, datasources <span class="op">=</span> <span class="va">connections</span><span class="op">)</span></span>
<span><span class="va">pca_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertPCA.html">ds.vertPCA</a></span><span class="op">(</span>cor_result <span class="op">=</span> <span class="va">cor_pca</span>, n_components <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">pca_dist</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th>Component</th>
<th>Eigenvalue</th>
<th>Variance (%)</th>
<th>Cumulative (%)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>PC1</td>
<td>1.6154</td>
<td>32.31</td>
<td>32.31</td>
</tr>
<tr class="even">
<td>PC2</td>
<td>1.0711</td>
<td>21.42</td>
<td>53.73</td>
</tr>
<tr class="odd">
<td>PC3</td>
<td>0.9566</td>
<td>19.13</td>
<td>72.86</td>
</tr>
<tr class="even">
<td>PC4</td>
<td>0.9084</td>
<td>18.17</td>
<td>91.03</td>
</tr>
<tr class="odd">
<td>PC5</td>
<td>0.4485</td>
<td>8.97</td>
<td>100.00</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="distributed-glms">Distributed GLMs<a class="anchor" aria-label="anchor" href="#distributed-glms"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  server1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"bmi"</span><span class="op">)</span>,</span>
<span>  server2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glucose"</span><span class="op">)</span>,</span>
<span>  server3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cholesterol"</span>, <span class="st">"heart_rate"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">model_gaussian</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertGLM.html">ds.vertGLM</a></span><span class="op">(</span></span>
<span>  <span class="st">"D_aligned"</span>,</span>
<span>  y_var <span class="op">=</span> <span class="st">"bp"</span>,</span>
<span>  x_vars <span class="op">=</span> <span class="va">x_vars</span>,</span>
<span>  y_server <span class="op">=</span> <span class="st">"server2"</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>  datasources <span class="op">=</span> <span class="va">connections</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_gaussian</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><strong>Distributed Gaussian coefficients:</strong></p>
<table class="table">
<thead><tr class="header">
<th>Coefficient</th>
<th>Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td>76.4445</td>
</tr>
<tr class="even">
<td>age</td>
<td>0.0654</td>
</tr>
<tr class="odd">
<td>bmi</td>
<td>0.5411</td>
</tr>
<tr class="even">
<td>glucose</td>
<td>-0.0270</td>
</tr>
<tr class="odd">
<td>cholesterol</td>
<td>-0.0062</td>
</tr>
<tr class="even">
<td>heart_rate</td>
<td>0.2765</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_binomial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertGLM.html">ds.vertGLM</a></span><span class="op">(</span></span>
<span>  <span class="st">"D_aligned"</span>,</span>
<span>  y_var <span class="op">=</span> <span class="st">"hypertension"</span>,</span>
<span>  x_vars <span class="op">=</span> <span class="va">x_vars</span>,</span>
<span>  y_server <span class="op">=</span> <span class="st">"server2"</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"binomial"</span>,</span>
<span>  datasources <span class="op">=</span> <span class="va">connections</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_binomial</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><strong>Distributed Binomial coefficients:</strong></p>
<table class="table">
<thead><tr class="header">
<th>Coefficient</th>
<th>Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td>-4.8320</td>
</tr>
<tr class="even">
<td>age</td>
<td>0.0240</td>
</tr>
<tr class="odd">
<td>bmi</td>
<td>0.0487</td>
</tr>
<tr class="even">
<td>glucose</td>
<td>0.0056</td>
</tr>
<tr class="odd">
<td>cholesterol</td>
<td>-0.0051</td>
</tr>
<tr class="even">
<td>heart_rate</td>
<td>0.0354</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_poisson</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ds.vertGLM.html">ds.vertGLM</a></span><span class="op">(</span></span>
<span>  <span class="st">"D_aligned"</span>,</span>
<span>  y_var <span class="op">=</span> <span class="st">"visits"</span>,</span>
<span>  x_vars <span class="op">=</span> <span class="va">x_vars</span>,</span>
<span>  y_server <span class="op">=</span> <span class="st">"server2"</span>,</span>
<span>  family <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  datasources <span class="op">=</span> <span class="va">connections</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_poisson</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><strong>Distributed Poisson coefficients:</strong></p>
<table class="table">
<thead><tr class="header">
<th>Coefficient</th>
<th>Estimate</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td>1.6309</td>
</tr>
<tr class="even">
<td>age</td>
<td>-0.0054</td>
</tr>
<tr class="odd">
<td>bmi</td>
<td>-0.0063</td>
</tr>
<tr class="even">
<td>glucose</td>
<td>0.0062</td>
</tr>
<tr class="odd">
<td>cholesterol</td>
<td>-0.0015</td>
</tr>
<tr class="even">
<td>heart_rate</td>
<td>0.0068</td>
</tr>
</tbody>
</table>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="comparison">Comparison<a class="anchor" aria-label="anchor" href="#comparison"></a>
</h2>
<div class="section level3">
<h3 id="correlation-comparison">Correlation Comparison<a class="anchor" aria-label="anchor" href="#correlation-comparison"></a>
</h3>
<p>Within-server correlations are computed in plaintext and are
therefore exact. Cross-server correlations are computed via MHE
threshold decryption using the CKKS approximate encryption scheme. The
following table compares key cross-server pairs.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diff_cor</span> <span class="op">&lt;-</span> <span class="va">local_cor</span> <span class="op">-</span> <span class="va">cor_dist</span><span class="op">$</span><span class="va">correlation</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">local_cor</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">local_cor</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">diff_cor</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th>Pair</th>
<th>Local</th>
<th>Distributed</th>
<th>Difference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>age x glucose</td>
<td>-0.0997</td>
<td>-0.0997</td>
<td>0.0000</td>
</tr>
<tr class="even">
<td>age x cholesterol</td>
<td>0.2215</td>
<td>0.2215</td>
<td>0.0000</td>
</tr>
<tr class="odd">
<td>bmi x bp</td>
<td>0.2266</td>
<td>0.2266</td>
<td>0.0000</td>
</tr>
<tr class="even">
<td>bmi x heart_rate</td>
<td>0.3116</td>
<td>0.3117</td>
<td>+0.0001</td>
</tr>
<tr class="odd">
<td>age x heart_rate</td>
<td>-0.0878</td>
<td>-0.0877</td>
<td>+0.0001</td>
</tr>
</tbody>
</table>
<p>Maximum absolute error: 0.0001. Within-server correlations are exact;
cross-server differences arise from CKKS approximate arithmetic.</p>
</div>
<div class="section level3">
<h3 id="pca-comparison">PCA Comparison<a class="anchor" aria-label="anchor" href="#pca-comparison"></a>
</h3>
<p>Because PCA is computed via eigen decomposition of the correlation
matrix, its errors are propagated from the correlation differences.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Component <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PC"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>,</span>
<span>  Local <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">local_pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  Distributed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pca_dist</span><span class="op">$</span><span class="va">eigenvalues</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  Difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">local_pca</span><span class="op">$</span><span class="va">sdev</span><span class="op">^</span><span class="fl">2</span> <span class="op">-</span> <span class="va">pca_dist</span><span class="op">$</span><span class="va">eigenvalues</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th>Component</th>
<th>Local</th>
<th>Distributed</th>
<th>Difference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>PC1</td>
<td>1.6153</td>
<td>1.6154</td>
<td>-0.0001</td>
</tr>
<tr class="even">
<td>PC2</td>
<td>1.0710</td>
<td>1.0711</td>
<td>-0.0001</td>
</tr>
<tr class="odd">
<td>PC3</td>
<td>0.9567</td>
<td>0.9566</td>
<td>+0.0001</td>
</tr>
<tr class="even">
<td>PC4</td>
<td>0.9083</td>
<td>0.9084</td>
<td>-0.0001</td>
</tr>
<tr class="odd">
<td>PC5</td>
<td>0.4486</td>
<td>0.4485</td>
<td>+0.0001</td>
</tr>
</tbody>
</table>
<p>Maximum absolute eigenvalue difference is approximately 10^-4.</p>
</div>
<div class="section level3">
<h3 id="glm-comparison">GLM Comparison<a class="anchor" aria-label="anchor" href="#glm-comparison"></a>
</h3>
<p>For each GLM family, the coefficients from the local fit and the
distributed fit are compared. The distributed GLM uses Block Coordinate
Descent with L2 regularisation (<code>lambda = 1e-4</code>), which
introduces a small systematic bias toward zero.</p>
<p><strong>Gaussian:</strong></p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Coefficient <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_gaussian</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Local <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_gaussian</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  Distributed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_gaussian</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  Difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_gaussian</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_gaussian</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th>Coefficient</th>
<th>Local</th>
<th>Distributed</th>
<th>Difference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td>76.4455</td>
<td>76.4445</td>
<td>-0.0010</td>
</tr>
<tr class="even">
<td>age</td>
<td>0.0654</td>
<td>0.0654</td>
<td>+0.0000</td>
</tr>
<tr class="odd">
<td>bmi</td>
<td>0.5411</td>
<td>0.5411</td>
<td>+0.0001</td>
</tr>
<tr class="even">
<td>glucose</td>
<td>-0.0270</td>
<td>-0.0270</td>
<td>+0.0000</td>
</tr>
<tr class="odd">
<td>cholesterol</td>
<td>-0.0062</td>
<td>-0.0062</td>
<td>-0.0000</td>
</tr>
<tr class="even">
<td>heart_rate</td>
<td>0.2766</td>
<td>0.2765</td>
<td>-0.0000</td>
</tr>
</tbody>
</table>
<p><strong>Binomial:</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Coefficient <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_binomial</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Local <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_binomial</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  Distributed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_binomial</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  Difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_binomial</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_binomial</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th>Coefficient</th>
<th>Local</th>
<th>Distributed</th>
<th>Difference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td>-4.8323</td>
<td>-4.8320</td>
<td>+0.0004</td>
</tr>
<tr class="even">
<td>age</td>
<td>0.0240</td>
<td>0.0240</td>
<td>+0.0000</td>
</tr>
<tr class="odd">
<td>bmi</td>
<td>0.0486</td>
<td>0.0487</td>
<td>+0.0000</td>
</tr>
<tr class="even">
<td>glucose</td>
<td>0.0056</td>
<td>0.0056</td>
<td>+0.0000</td>
</tr>
<tr class="odd">
<td>cholesterol</td>
<td>-0.0051</td>
<td>-0.0051</td>
<td>-0.0000</td>
</tr>
<tr class="even">
<td>heart_rate</td>
<td>0.0354</td>
<td>0.0354</td>
<td>-0.0000</td>
</tr>
</tbody>
</table>
<p><strong>Poisson:</strong></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  Coefficient <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_poisson</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  Local <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_poisson</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  Distributed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_poisson</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  Difference <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_poisson</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">model_poisson</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th>Coefficient</th>
<th>Local</th>
<th>Distributed</th>
<th>Difference</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td>1.6309</td>
<td>1.6309</td>
<td>+0.0000</td>
</tr>
<tr class="even">
<td>age</td>
<td>-0.0054</td>
<td>-0.0054</td>
<td>-0.0000</td>
</tr>
<tr class="odd">
<td>bmi</td>
<td>-0.0063</td>
<td>-0.0063</td>
<td>-0.0000</td>
</tr>
<tr class="even">
<td>glucose</td>
<td>0.0062</td>
<td>0.0062</td>
<td>-0.0000</td>
</tr>
<tr class="odd">
<td>cholesterol</td>
<td>-0.0015</td>
<td>-0.0015</td>
<td>+0.0000</td>
</tr>
<tr class="even">
<td>heart_rate</td>
<td>0.0068</td>
<td>0.0068</td>
<td>+0.0000</td>
</tr>
</tbody>
</table>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="error-summary">Error Summary<a class="anchor" aria-label="anchor" href="#error-summary"></a>
</h2>
<table style="width:100%;" class="table">
<colgroup>
<col width="25%">
<col width="22%">
<col width="51%">
</colgroup>
<thead><tr class="header">
<th>Analysis</th>
<th>Max</th>
<th>Error</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Correlation</td>
<td>~10^-4</td>
<td>CKKS approximate arithmetic</td>
</tr>
<tr class="even">
<td>PCA Eigenvalues</td>
<td>~10^-4</td>
<td>Propagated from correlation</td>
</tr>
<tr class="odd">
<td>GLM Gaussian</td>
<td>~10^-3</td>
<td>L2 regularisation + BCD convergence</td>
</tr>
<tr class="even">
<td>GLM Binomial</td>
<td>~10^-3</td>
<td>Same + logistic nonlinearity</td>
</tr>
<tr class="odd">
<td>GLM Poisson</td>
<td>~10^-4</td>
<td>Same + exp link</td>
</tr>
</tbody>
</table>
<p>All distributed results match local R analysis to high accuracy.
Small differences arise from three independent sources:</p>
<ol style="list-style-type: decimal">
<li><p><strong>CKKS approximation error</strong> â€“ The homomorphic
encryption scheme used for cross-server correlation encodes real numbers
with finite precision. With the default <code>log_scale = 40</code>,
individual operations carry approximately 12 decimal digits of
precision, but the accumulation of additions in the inner product
results in final errors around 10^-4 for typical sample sizes.</p></li>
<li><p><strong>L2 regularisation</strong> â€“ The BCD algorithm adds a
small ridge penalty (<code>lambda = 1e-4</code>) to the diagonal of each
blockâ€™s cross-product matrix. This prevents singular or near-singular
systems during iterative updates but introduces a small systematic bias
toward zero.</p></li>
<li><p><strong>BCD convergence tolerance</strong> â€“ The iterative solver
terminates when the relative change in coefficients falls below a
threshold, leaving residual optimisation error that is negligible in
practice.</p></li>
</ol>
<hr>
</div>
<div class="section level2">
<h2 id="cleanup">Cleanup<a class="anchor" aria-label="anchor" href="#cleanup"></a>
</h2>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://datashield.github.io/DSI/reference/datashield.logout.html" class="external-link">datashield.logout</a></span><span class="op">(</span><span class="va">connections</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

<div class="pkgdown-footer-right">

</div>

    </footer>
</div>





  </body>
</html>
