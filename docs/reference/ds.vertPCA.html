<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Principal Component Analysis for Vertically Partitioned Data — ds.vertPCA • dsVertClient</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Principal Component Analysis for Vertically Partitioned Data — ds.vertPCA"><meta name="description" content="Performs PCA on vertically partitioned data using the
privacy-preserving correlation matrix computed via Homomorphic Encryption."><meta property="og:description" content="Performs PCA on vertically partitioned data using the
privacy-preserving correlation matrix computed via Homomorphic Encryption."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dsVertClient</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/a-getting-started.html">Getting Started with dsVertClient</a></li>
    <li><a class="dropdown-item" href="../articles/b-statistical-analysis.html">Statistical Analysis</a></li>
    <li><a class="dropdown-item" href="../articles/c-methodology.html">Methodology</a></li>
    <li><a class="dropdown-item" href="../articles/d-validation.html">Validation</a></li>
    <li><a class="dropdown-item" href="../articles/e-security.html">Security Model</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/isglobal-brge/dsVertClient" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Principal Component Analysis for Vertically Partitioned Data</h1>
      <small class="dont-index">Source: <a href="https://github.com/isglobal-brge/dsVertClient/blob/HEAD/R/ds.vertPCA.R" class="external-link"><code>R/ds.vertPCA.R</code></a></small>
      <div class="d-none name"><code>ds.vertPCA.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Performs PCA on vertically partitioned data using the
privacy-preserving correlation matrix computed via Homomorphic Encryption.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ds.vertPCA</span><span class="op">(</span></span>
<span>  data_name <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  variables <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_components <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cor_result <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  log_n <span class="op">=</span> <span class="fl">12</span>,</span>
<span>  log_scale <span class="op">=</span> <span class="fl">40</span>,</span>
<span>  datasources <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-data-name">data_name<a class="anchor" aria-label="anchor" href="#arg-data-name"></a></dt>
<dd><p>Character string. Name of the (aligned) data frame on
each server. Ignored if <code>cor_result</code> is provided.</p></dd>


<dt id="arg-variables">variables<a class="anchor" aria-label="anchor" href="#arg-variables"></a></dt>
<dd><p>A named list where each name corresponds to a server name
and each element is a character vector of variable names from that server.
Ignored if <code>cor_result</code> is provided.</p></dd>


<dt id="arg-n-components">n_components<a class="anchor" aria-label="anchor" href="#arg-n-components"></a></dt>
<dd><p>Integer. Number of principal components to return.
Default is NULL (returns all).</p></dd>


<dt id="arg-cor-result">cor_result<a class="anchor" aria-label="anchor" href="#arg-cor-result"></a></dt>
<dd><p>An existing <code>ds.cor</code> object from <code><a href="ds.vertCor.html">ds.vertCor</a></code>.
If provided, the MHE protocol is NOT re-run; the PCA is computed directly
from this correlation matrix. This avoids running the expensive MHE protocol
twice when you already have the correlation.</p></dd>


<dt id="arg-log-n">log_n<a class="anchor" aria-label="anchor" href="#arg-log-n"></a></dt>
<dd><p>Integer. CKKS ring dimension parameter for MHE. Default is 12.
Ignored if <code>cor_result</code> is provided.</p></dd>


<dt id="arg-log-scale">log_scale<a class="anchor" aria-label="anchor" href="#arg-log-scale"></a></dt>
<dd><p>Integer. CKKS precision parameter for MHE. Default is 40.
Ignored if <code>cor_result</code> is provided.</p></dd>


<dt id="arg-datasources">datasources<a class="anchor" aria-label="anchor" href="#arg-datasources"></a></dt>
<dd><p>DataSHIELD connection object or list of connections.
If NULL, uses all available connections. Ignored if <code>cor_result</code> is
provided.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with class "ds.pca" containing:</p><ul><li><p><code>loadings</code>: Matrix of variable loadings (n_vars x n_components)</p></li>
<li><p><code>eigenvalues</code>: Eigenvalues for each component</p></li>
<li><p><code>variance_pct</code>: Percentage of variance explained</p></li>
<li><p><code>cumulative_pct</code>: Cumulative percentage explained</p></li>
<li><p><code>var_names</code>: Variable names</p></li>
<li><p><code>n_obs</code>: Number of observations</p></li>
<li><p><code>correlation</code>: The correlation matrix used for PCA</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function performs PCA using the correlation matrix obtained via
Multiparty Homomorphic Encryption (MHE). The approach is:</p>
<ol><li><p>Compute the privacy-preserving correlation matrix using <code><a href="ds.vertCor.html">ds.vertCor</a></code>
(or reuse an existing one via the <code>cor_result</code> parameter)</p></li>
<li><p>Perform eigen decomposition on the correlation matrix</p></li>
<li><p>Extract loadings (eigenvectors) and eigenvalues</p></li>
</ol><p>Since PCA on standardized data is equivalent to eigen decomposition of the
correlation matrix, this gives correct loadings and variance explained.</p>
<p><strong>Note on scores:</strong> This function does NOT return principal component
scores because computing scores would require access to the raw data.
If you need scores, you would need to compute them on each server using
the loadings and aggregate the results (which is a separate operation).</p>
<div class="section">
<h3 id="interpreting-loadings">Interpreting Loadings<a class="anchor" aria-label="anchor" href="#interpreting-loadings"></a></h3>
<p>Each column of the loadings matrix represents a principal component.
The values show how much each variable contributes to that component:</p><ul><li><p>Values close to 1 or -1 indicate strong contribution</p></li>
<li><p>Values close to 0 indicate weak contribution</p></li>
<li><p>Sign indicates direction of relationship</p></li>
</ul></div>

    </div>
    <div class="section level2">
    <h2 id="security">Security<a class="anchor" aria-label="anchor" href="#security"></a></h2>


<p>This function inherits all security properties from <code><a href="ds.vertCor.html">ds.vertCor</a></code>:</p><ul><li><p>Individual observations are never exposed</p></li>
<li><p>The client cannot decrypt without all servers cooperating</p></li>
<li><p>Only aggregate statistics (correlation matrix) are revealed</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="ds.vertCor.html">ds.vertCor</a></code> for correlation analysis</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">vars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  server1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age"</span>, <span class="st">"weight"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  server2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"height"</span>, <span class="st">"bmi"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pca_result</span> <span class="op">&lt;-</span> <span class="fu">ds.vertPCA</span><span class="op">(</span><span class="st">"D_aligned"</span>, <span class="va">vars</span>, n_components <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Or reuse an existing correlation result (avoids running MHE again):</span></span></span>
<span class="r-in"><span><span class="va">cor_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="ds.vertCor.html">ds.vertCor</a></span><span class="op">(</span><span class="st">"D_aligned"</span>, <span class="va">vars</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">pca_result</span> <span class="op">&lt;-</span> <span class="fu">ds.vertPCA</span><span class="op">(</span>cor_result <span class="op">=</span> <span class="va">cor_result</span>, n_components <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View variance explained</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Biplot of loadings for first two PCs</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">loadings</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">pca_result</span><span class="op">$</span><span class="va">loadings</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>     xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     xlab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PC1 ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">variance_pct</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%)"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>     ylab <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"PC2 ("</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">variance_pct</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"%)"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">pca_result</span><span class="op">$</span><span class="va">loadings</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, <span class="va">pca_result</span><span class="op">$</span><span class="va">loadings</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>     labels <span class="op">=</span> <span class="va">pca_result</span><span class="op">$</span><span class="va">var_names</span>, pos <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, v <span class="op">=</span> <span class="fl">0</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

<div class="pkgdown-footer-right">

</div>

    </footer></div>





  </body></html>

